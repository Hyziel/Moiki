(this["webpackJsonpmoiki-player"]=this["webpackJsonpmoiki-player"]||[]).push([[0],{342:function(e){e.exports=JSON.parse('{"a":"0.6.1"}')},344:function(e,t,n){e.exports=n.p+"static/media/logo.aa710516.svg"},359:function(e,t,n){e.exports=n(656)},614:function(e,t,n){},621:function(e,t,n){},623:function(e,t,n){},624:function(e,t,n){},625:function(e,t,n){},626:function(e,t,n){},627:function(e,t){},653:function(e,t,n){},655:function(e,t,n){},656:function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"standard",(function(){return B})),n.d(a,"dark",(function(){return U})),n.d(a,"army",(function(){return P})),n.d(a,"oldScreen",(function(){return H})),n.d(a,"comic",(function(){return V})),n.d(a,"pastel",(function(){return W}));var r={};n.r(r),n.d(r,"superhero",(function(){return G})),n.d(r,"glow",(function(){return Y})),n.d(r,"retro",(function(){return J})),n.d(r,"inset",(function(){return K})),n.d(r,"longShadow",(function(){return Z}));n(360),n(379);var o=n(0),c=n.n(o),l=n(334),i=n.n(l),s=n(2),u=n(67),m=n(7),d=n(109),f=n(24),b=n(30),g=n(133),v=n(335),y=n.n(v),E=n(74),p=n(349),h=n(670),O={fade:{label:"Fade",data:{from:{opacity:0},enter:{opacity:1},leave:{opacity:0},config:{duration:350,easing:h.a}}},zoom:{label:"Zoom",data:{from:{transform:"scale(0)"},enter:{transform:"scale(1)"},leave:{transform:"scale(0)"},config:{duration:350,easing:h.a}}},rotateZoom:{label:"Rotation",data:{from:{transform:"scale(0) rotate(0deg)"},enter:{transform:"scale(1) rotate(720deg)"},leave:{transform:"scale(0) rotate(1080deg)"},config:{duration:550,easing:h.a}}}},S=function(e){return(O[e]||O.zoom).data},j={fade:{label:"Fade",fn:function(){return""}},zoom:{label:"Zoom",fn:function(e){var t=1-e/100;return"translateY(".concat(e,"px) scale(").concat(t,", ").concat(t,")")}},unzoom:{label:"Dezoom",fn:function(e){var t=1+e/100;return"translateY(".concat(e,"px) scale(").concat(t,", ").concat(t,")")}},pop:{label:"Rotation",fn:function(e){var t=90-90*(1-Math.abs(e)/100);return"translateY(".concat(e,"px) rotateY(-").concat(t,"deg)")}}},k=function(e){return(j[e]||j.unzoom).fn},w={fade:{label:"Fade",data:{from:{opacity:0},enter:{opacity:1},leave:{opacity:0},config:{duration:350,easing:h.a}}},zoom:{label:"Zoom",data:{from:{transform:"scale(0)"},enter:{transform:"scale(1)"},leave:{transform:"scale(0)"},config:{duration:350,easing:h.a}}},rotateZoom:{label:"Rotation",data:{from:{transform:"scale(0) rotate(0deg)"},enter:{transform:"scale(1) rotate(720deg)"},leave:{transform:"scale(0) rotate(1080deg)"},config:{duration:550,easing:h.a}}}},x=function(e){return(w[e]||w.zoom).data},R=function(e,t,n){var a=t.target,r=t.condition;if("hero"===(n.assets[a]||{}).kind)switch(r){case"with":return e.hero===a;case"without":return e.hero!==a;default:console.log("unknown condition: ",r)}else{var o=e.objects||[];switch(r){case"with":return o.includes(a);case"without":return!o.includes(a);default:console.log("unknown condition: ",r)}}return null},C=function(e,t,n){var a,r=n.target,o=n.condition,c=n.value,l=void 0===c?0:c,i=n.valueType,s=n.minValueType,u=n.minValue,m=n.maxValueType,d=n.maxValue,f=e.counters[r]||{},b=t.counters||[],g=b.find((function(e){return e.id===r}));switch(i){case"random":var v,y;switch(s){case"counter":var E=b.find((function(e){return e.id===u}));v=E?E.value:f.min;break;default:v=u||f.min}switch(m){case"counter":var p=b.find((function(e){return e.id===d}));y=p?p.value:f.max;break;default:y=d||f.max}a=Math.floor(Math.random()*(y-v+1))+v;break;case"counter":a=b.find((function(e){return e.id===l})).value||0;break;default:a=l}if(g)switch(o){case"=":return g.value===a;case"!=":return g.value!==a;case">":return g.value>a;case">=":return g.value>=a;case"<":return g.value<a;case"<=":return g.value<=a;default:console.log("unknown condition: ",o)}return null},T=function(e,t){var n=t.target,a=t.condition,r=t.value,o=(e.textvars||[]).find((function(e){return e.id===n}));if(o)switch(a){case"=":return o.value===r;case"!=":return o.value!==r;default:console.log("unknown condition: ",a)}return null},N=function(e,t){var n=t.target,a=t.condition,r=e||[];switch(a){case"by":return r.includes(n);case"not-by":return!r.includes(n);default:console.log("unknown condition: ",a)}return null},q=function(e,t,n,a){var r=a.kind,o=a.query,c=o.params||[],l=Object(s.a)(c,1)[0],i=void 0===l?{}:l;switch(r){case"object":return R(t,i,e);case"counter":return C(e,t,i);case"textvar":return T(t,i);case"passage":return N(n,i);case"multiple":return function(e,t,n,a){var r,o=a.operator,c=a.params,l="and"===o,i=l&&c.length>0,s=!1,u=Object(b.a)(c||[]);try{for(u.s();!(r=u.n()).done;){var m=r.value;switch(m.kind){case"object":s=R(t,m,e);break;case"counter":s=C(e,t,m);break;case"textvar":s=T(t,m);break;case"passage":s=N(n,m);break;default:console.log("unknown multi-condition item kind",m.kind)}i=l?i&&s:i||s}}catch(d){u.e(d)}finally{u.f()}return i}(e,t,n,o);default:return r&&console.log("unknown condition kind: ",r),!1}},I=function(e,t,n,a){var r=null;if(a&&a.length>0)for(var o=0;o<a.length&&!r;){var c=a[o];q(e,t,n,c)&&(r=c.next),++o}return r},_=n(674),L=n(177),z=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.replace(/\s([?!:\xbb])/g,"\xa0$1").replace(/(\xab)\s/g,"$1\xa0")},D=function(e){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.replace(/\s([?!:\xbb])/g,"&nbsp;$1").replace(/(\xab)\s/g,"$1&nbsp;")}(Object(L.sanitize)(e))},M=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.replace(/(\s*&nbsp;\s*)+/g,'<span class="unbreak-spaces">&nbsp;</span>')},F={fr:{PRESENT:"Moiki pr\xe9sente",STORY_BY:"Une histoire de",ADAPTED_BY:"adaptation Moiki par",CREDITS:"Cr\xe9dits",COVER:"Image de couverture",IMAGES:"Images / Photos",ALL_RIGHTS_RESERVED:"Droits r\xe9serv\xe9s",ICONS:"Ic\xf4nes",ICONS_FROM:"Toutes les ic\xf4nes proviennent de",LICENSE:"licence:",SOUNDS:"Sons",SOUNDS_FROM:"Tous les sons proviennent de",PROGRESSION:"Progression",SEQ_FOUND:"S\xe9quences d\xe9couvertes :",HEROES_FOUND:"H\xe9ros obtenus :",OBJ_FOUND:"Objets d\xe9couverts :",STATS:"Stats",SHOW_STATS:"voir les stats",NUM_UNDO:"Retours en arri\xe8re :",NUM_GAMES:"Parties commenc\xe9es :",NUM_VICTORIES:"Nombre de victoires :",NUM_DEFEATS:"Nombre de d\xe9faites :",RESTART:"Recommencer",RESET:"R\xe9initialiser et recommencer",RETRY:"R\xe9essayer",REPORT:"signaler ce contenu",REPORT_THIS:"Signaler",SHOW_CREDITS:"voir les cr\xe9dits",REPORT_SENT:"Signalement envoy\xe9 !",RETRY_REASON:"Je souhaite signaler cette histoire pour la raison suivante\xa0:",OFFENSIVE:"Caract\xe8re offensant",DUPLICATA:"Contenu dupliqu\xe9 (plagiat)",OTHER_REASON:"Autre raison",USEFUL_INFO:"Informations utiles",SEND:"Envoyer",LOADING_SOUNDS:"t\xe9l\xe9chargement des sons",OBJ_WON:"Objets remport\xe9s",NO_OBJ_WON:"Vous n'avez gagn\xe9 aucun objet",READ_MORE:"En savoir plus",REVIEWS:"Avis",SHARE:"Partager",BACK:"Retour",UNKNOWN:"Inconnu",RESUME:"Reprendre ?",RESUME_MSG:"Voulez-vous reprendre votre partie en cours\xa0?",RESUME_DATE:"sauvegard\xe9e il y a %s",RESUME_ALERT:"En choisissant de commencer une nouvelle partie, votre sauvegarde sera perdue\xa0!",DO_NOT_RESUME:"Recommencer depuis le d\xe9but",LOAD:"Reprendre la partie",RESET_GAME:"R\xe9initialiser",RESET_MSG:"En r\xe9initialisant le jeu, vous repartirez depuis le d\xe9but et vos statistiques seront remises \xe0 z\xe9ro.",RESTART_MSG:"En recommen\xe7ant le jeu, vous repartirez depuis le d\xe9but en conservant vos statistiques.",WILL_LOSE_BACKUP:"Attention, votre sauvegarde sera perdue\xa0!",CANCEL:"Annuler",ITS_FREE:"est une plateforme gratuite permettant de cr\xe9er des histoires \xe0 embranchements."},en:{PRESENT:"Moiki presents",STORY_BY:"A story by",ADAPTED_BY:"Moiki adaptation by",CREDITS:"Credits",COVER:"Cover picture",IMAGES:"Images / Pictures",ALL_RIGHTS_RESERVED:"All rights reserved",ICONS:"Icons",ICONS_FROM:"All icons come from",LICENSE:"license:",SOUNDS:"Sounds",SOUNDS_FROM:"All sounds come from",PROGRESSION:"Progression",SEQ_FOUND:"Discovered sequences:",HEROES_FOUND:"Heroes obtained:",OBJ_FOUND:"Objects discovered:",STATS:"Stats",SHOW_STATS:"see stats",NUM_UNDO:"Backwards:",NUM_GAMES:"Started games:",NUM_VICTORIES:"Number of wins:",NUM_DEFEATS:"Number of defeats:",RESTART:"Start again",RESET:"Reset and restart",RETRY:"Retry",REPORT:"report this content",REPORT_THIS:"Report",SHOW_CREDITS:"see credits",REPORT_SENT:"Report sent!",REPORT_REASON:"I would like to report this story for the following reason:",OFFENSIVE:"Offensive nature",DUPLICATA:"Duplicate content (plagiarism)",OTHER_REASON:"Other reason",USEFUL_INFO:"Useful information",SEND:"Send",LOADING_SOUNDS:"downloading sounds",OBJ_WON:"Won objects",NO_OBJ_WON:"You have not won any items",READ_MORE:"Read more",REVIEWS:"Reviews",SHARE:"Share",BACK:"Back",UNKNOWN:"Unknown",RESUME:"Resume?",RESUME_MSG:"Do you want to resume your game in progress?",RESUME_DATE:"saved %s ago",RESUME_ALERT:"By choosing to start a new game, your backup will be lost!",DO_NOT_RESUME:"Start a new game",LOAD:"Resume the game",RESET_GAME:"Reset",RESET_MSG:"By resetting the game, you will start from the beginning and your statistics will be reset to zero.",RESTART_MSG:"By restarting the game, you will start again from the beginning by keeping your statistics.",WILL_LOSE_BACKUP:"Be careful, your backup will be lost!",CANCEL:"Cancel",ITS_FREE:"is a free platform to create branching stories."}},A=Object(o.createContext)(F.fr),B={name:"standard",styles:{background:"#4c77ac",fontFamily:"Catamaran",topbarBackground:"#154f6b",topbarText:"#ffffff",sequenceBackground:"#446a9a",sequenceText:"#ffffff",buttonBackground:"#4eb5f1",buttonText:"#ffffff",assetsBackground:"rgba(21, 79, 107, 0.27)",assetsFill:"#ffffff",sfx:{},animations:{sequence:"unzoom",objectModal:"zoom",objectModalDecorator:"star"},textStyle:{}}},U={name:"dark",styles:{background:"rgba(0, 0, 0, 1)",fontFamily:"Londrina Solid",buttonBackground:"rgba(255, 255, 255, 0.18)",sequenceBackground:"rgba(0, 0, 0, 0.8)",assetsBackground:"rgba(0, 0, 0, 0.76)",sequenceText:"rgba(255, 255, 255, 1)",topbarBackground:"rgba(22, 31, 31, 1)",topbarText:"rgba(131, 130, 130, 1)",assetsFill:"rgba(255, 255, 255, 1)",sfx:{},animations:{sequence:"fade",objectModal:"rotateZoom",objectModalDecorator:"star"},textStyle:{}}},P={name:"army",styles:{textStyle:{params:{color:"rgba(156, 221, 91, 1)",color2:"rgba(65, 117, 5, 1)",size:1.5},type:"glow"},animations:{sequence:"fade",objectModal:"zoom",objectModalDecorator:"star"},background:"rgba(104, 151, 53, 1)",fontFamily:"Black Ops One",buttonBackground:"rgba(255, 255, 255, 0.18)",sequenceBackground:"rgba(125, 179, 69, 0.9)",assetsBackground:"rgba(65, 117, 5, 1)",sequenceText:"rgba(51, 51, 48, 1)",topbarBackground:"rgba(126, 211, 33, 0.69)",topbarText:"rgba(65, 117, 5, 1)",assetsFill:"rgba(184, 233, 134, 1)",sfx:{}}},H={name:"old-screen",styles:{background:"rgba(0, 0, 0, 1)",fontFamily:"Ubuntu",topbarBackground:"rgba(0, 0, 0, 1)",topbarText:"rgba(110, 169, 37, 1)",sequenceBackground:"rgba(0, 0, 0, 1)",sequenceText:"rgba(184, 233, 134, 1)",buttonBackground:"rgba(184, 233, 134, 1)",buttonText:"rgba(0, 0, 0, 1)",assetsBackground:"rgba(87, 126, 48, 0.59)",assetsFill:"rgba(209, 236, 182, 1)",sfx:{},animations:{sequence:"fade",objectModal:"fade"},textStyle:{type:"glow",params:{size:8,color2:"rgba(126, 211, 33, 1)",color:"rgba(65, 117, 5, 1)"}}}},V={name:"comic",styles:{background:"rgba(116, 140, 160, 1)",fontFamily:"Bowlby One SC",topbarBackground:"rgba(69, 74, 77, 1)",topbarText:"#ffffff",sequenceBackground:"rgba(161, 166, 126, 0)",sequenceText:"#ffffff",buttonBackground:"rgba(0, 0, 0, 0.23)",buttonText:"rgba(255, 255, 255, 1)",assetsBackground:"rgba(0, 0, 0, 0.23)",assetsFill:"#ffffff",sfx:{},animations:{sequence:"zoom",objectModal:"zoom"},textStyle:{type:"superhero",params:{size:3.5,color2:"rgba(158, 158, 158, 1)",color:"rgba(83, 82, 82, 1)"}}}},W={name:"pastel",styles:{background:"rgba(166, 151, 126, 1)",fontFamily:"Cantarell",topbarBackground:"rgba(69, 74, 77, 1)",topbarText:"#ffffff",sequenceBackground:"rgba(161, 166, 126, 1)",sequenceText:"#ffffff",buttonBackground:"rgba(166, 132, 126, 1)",buttonText:"#ffffff",assetsBackground:"rgba(82, 107, 21, 0)",assetsFill:"#ffffff",sfx:{},animations:{sequence:"fade",objectModal:"fade"},textStyle:{type:"glow",params:{size:1,color2:"rgba(158, 158, 158, 1)"}}}},G=function(e){var t=e.color,n=void 0===t?"#000":t,a=e.size,r=void 0===a?1:a,o="".concat(.02*r,"em"),c="".concat(.06*r,"em");return{textShadow:"\n      0 -".concat(o," 0 ").concat(n,",\n      0 -").concat(o," 0 ").concat(n,",\n      0 ").concat(o," 0 ").concat(n,",\n      0 ").concat(o," 0 ").concat(n,",\n      -").concat(o," 0 0 ").concat(n,",  \n      ").concat(o," 0 0 ").concat(n,",\n      -").concat(o," 0 0 ").concat(n,",\n      ").concat(o," 0 0 ").concat(n,",\n      -").concat(o," -").concat(o," 0 ").concat(n,",  \n      ").concat(o," -").concat(o," 0 ").concat(n,",\n      -").concat(o," ").concat(o," 0 ").concat(n,",\n      ").concat(o," ").concat(o," 0 ").concat(n,",\n      -").concat(o," ").concat(c," 0 ").concat(n,",\n      0 ").concat(c," 0 ").concat(n,",\n      ").concat(o," ").concat(c," 0 ").concat(n)}},Y=function(e){var t=e.color,n=void 0===t?"#000":t,a=e.color2,r=void 0===a?"#fff":a,o=e.size,c=void 0===o?1:o;return{textShadow:"\n    0 0 ".concat(.05*c,"em ").concat(r,",\n    0 0 ").concat(.1*c,"em ").concat(n)}},J=function(e){var t=e.color,n=void 0===t?"#000":t,a=e.size,r=void 0===a?1:a;return{textShadow:"".concat(n," ").concat(.04*r,"em ").concat(.03*r,"em 0")}},K=function(e){var t=e.color,n=void 0===t?"#000":t,a=e.size,r="".concat(.05*(void 0===a?1:a),"em");return{textShadow:"".concat(n," ").concat(r," ").concat(r," 0")}},Z=function(e){for(var t=e.color,n=void 0===t?"#000":t,a=e.size,r=[],o=void 0===a?1:a;o>0;)r.push(o),o-=.25;return{textShadow:r.map((function(e){return"".concat(e,"px ").concat(e,"px ").concat(n)})).join(",")}},X=Object.entries(a).map((function(e){var t=Object(s.a)(e,2);t[0];return t[1]})),$=B,Q=function(e,t){var n,a=e.themes.find((function(e){return e.identifier===t}))||{},o=X.find((function(e){return e.name===a.name}))||B,c=a.styles?a.styles:{},l=Object(m.a)({},o.styles,{},c),i=(n=l.textStyle)&&n.type&&"function"===typeof r[n.type]?r[n.type](n.params||{}):{};return{sequenceStyles:l,textStyle:i,sequence:{background:l.sequenceBackground,color:l.sequenceText,fontFamily:l.fontFamily},button:Object(m.a)({background:l.buttonBackground,color:l.buttonText,fontFamily:l.fontFamily},i)}},ee=function(e){var t=e.value,n=e.size,a=void 0===n?4:n,r=e.styles,o=void 0===r?{}:r;return Array.from({length:a}).map((function(e,n){return c.a.createElement("div",{key:"charcode-"+n,className:"sequence-content",style:{margin:2,width:"2em",height:"2em",overflow:"hidden"}},c.a.createElement("div",{style:Object(m.a)({},o.sequence,{overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center"})},t.slice(n,n+1)||"_"))}))},te=function(e){var t=e.resetCode,n=e.puzzle,a=e.styles,r=e.onCodeEntered,l=Object(o.useState)(!1),i=Object(s.a)(l,2),u=i[0],d=i[1],f=Object(o.useState)(!1),b=Object(s.a)(f,2),v=b[0],y=b[1],E=Object(o.useState)(""),p=Object(s.a)(E,2),h=p[0],O=p[1],S=function(e){O((h+e).slice(0,n.size))},j=function(){O(h.slice(0,-1))};Object(o.useEffect)((function(){d(h.length===n.size),y(h.length>0)}),[h]),Object(o.useEffect)((function(){t||(O(""),y(!1),d(!1))}),[t]);var k="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");return c.a.createElement("div",{className:"puzzle-renderer",style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%"}},c.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",marginBottom:10,flexGrow:1}},c.a.createElement(ee,{value:h,size:n.size,styles:a})),"numeric"===n.kind&&c.a.createElement(o.Fragment,null,c.a.createElement("div",{className:"pad-buttons",style:{display:"flex",alignItems:"center",justifyContent:"center"}},c.a.createElement("button",{style:a.button,onClick:function(){return S("1")}},"1"),c.a.createElement("button",{style:a.button,onClick:function(){return S("2")}},"2"),c.a.createElement("button",{style:a.button,onClick:function(){return S("3")}},"3")),c.a.createElement("div",{className:"pad-buttons",style:{display:"flex",alignItems:"center",justifyContent:"center"}},c.a.createElement("button",{style:a.button,onClick:function(){return S("4")}},"4"),c.a.createElement("button",{style:a.button,onClick:function(){return S("5")}},"5"),c.a.createElement("button",{style:a.button,onClick:function(){return S("6")}},"6")),c.a.createElement("div",{className:"pad-buttons",style:{display:"flex",alignItems:"center",justifyContent:"center"}},c.a.createElement("button",{style:a.button,onClick:function(){return S("7")}},"7"),c.a.createElement("button",{style:a.button,onClick:function(){return S("8")}},"8"),c.a.createElement("button",{style:a.button,onClick:function(){return S("9")}},"9")),c.a.createElement("div",{className:"pad-buttons",style:{display:"flex",alignItems:"center",justifyContent:"center"}},c.a.createElement("button",{disabled:!v,style:Object(m.a)({},a.button,{opacity:v?1:.5}),onClick:function(){return O("")}},c.a.createElement(g.a,{name:"close",style:{margin:0,display:"flex",width:10.5,justifyContent:"center"}})),c.a.createElement("button",{style:a.button,onClick:function(){return S("0")}},"0"),c.a.createElement("button",{disabled:!v,style:Object(m.a)({},a.button,{opacity:v?1:.5}),onClick:function(){return j()}},c.a.createElement(g.a,{name:"angle left",style:{margin:0,display:"flex",width:10.5,justifyContent:"center"}})))),"alpha"===n.kind&&c.a.createElement(o.Fragment,null,[0,1,2,3].map((function(e){return c.a.createElement("div",{key:"alphakeys-"+e,className:"pad-buttons small",style:{display:"flex",alignItems:"center",justifyContent:"center"}},k&&k.slice(6*e,6*e+6).map((function(e){return c.a.createElement("button",{key:"alphakey-"+e,style:a.button,onClick:function(){return S(e)}},e)})))})),c.a.createElement("div",{className:"pad-buttons",style:{display:"flex",alignItems:"center",justifyContent:"center"}},c.a.createElement("button",{disabled:!v,style:Object(m.a)({},a.button,{opacity:v?1:.5}),onClick:function(){return O("")}},c.a.createElement(g.a,{name:"trash",style:{margin:0,display:"flex",width:10.5,justifyContent:"center"}})),c.a.createElement("button",{style:Object(m.a)({},a.button,{width:46}),onClick:function(){return S(k.slice(-2)[0])}},k.slice(-2)[0]),c.a.createElement("button",{style:Object(m.a)({},a.button,{width:46}),onClick:function(){return S(k.slice(-1)[0])}},k.slice(-1)[0]),c.a.createElement("button",{disabled:!v,style:Object(m.a)({},a.button,{opacity:v?1:.5}),onClick:function(){return j()}},c.a.createElement(g.a,{name:"angle left",style:{margin:0,display:"flex",width:10.5,justifyContent:"center"}})))),c.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",marginTop:10}},c.a.createElement("button",{disabled:!u,style:Object(m.a)({},a.button,{opacity:u?1:.5}),onClick:function(){r&&r(h)}},c.a.createElement(g.a,{name:"caret right",style:{margin:0}}))))},ne=n(242),ae=(n(614),{position:"absolute",right:2,top:2,margin:7,zIndex:1,opacity:.8,borderRadius:"1em"}),re={padding:".3em .35em",fontSize:".8em",margin:0},oe=function(e){var t=e.wrapper,n=e.image,a=Object(o.useState)({}),r=Object(s.a)(a,2),l=r[0],i=r[1];return Object(o.useEffect)((function(){t&&i({width:t.offsetWidth||"100%",height:t.offsetHeight||"100%"})}),[t]),c.a.createElement(ne.a,null,c.a.createElement("div",{style:Object(m.a)({},l,{display:"flex",justifyContent:"center",alignItems:"center"})},c.a.createElement("img",{src:n,alt:"",style:{width:"100%",height:"auto"}})))},ce=function(e){var t=Object(o.createRef)(),n=e.styles,a=e.image,r=e.onClose;return c.a.createElement("div",{className:"magnifier-container",ref:t,style:{position:"absolute",zIndex:90,top:0,left:0,right:0,bottom:0,background:"#fff"}},c.a.createElement("div",{style:{width:"100%",height:"100%",background:n&&n.sequenceStyles?n.sequenceStyles.background:"#000",display:"flex",justifyContent:"center",alignItems:"center"}},c.a.createElement(ne.b,{initialScale:1},(function(){return c.a.createElement(oe,{wrapper:t?t.current:null,image:a})})),c.a.createElement("div",{style:Object(m.a)({},ae,{background:n&&n.sequenceStyles?n.sequenceStyles.background:"#000"})},c.a.createElement("button",{style:Object(m.a)({},n.button,{},re),onClick:r},c.a.createElement(g.a,{name:"close",style:{margin:0}})))))},le=function(e){var t=e.story,n=e.gameData,a=e.path,r=e.routineExit,l=e.randomSeeds,i=e.sequence,u=e.gotoSequence,f=e.playClickSound,b=e.theme,v=e.styles,y=e.showStats,O=e.addReview,S=e.canAddReview,j=e.undo,w=e.canUndo,x=e.onReplay,R=e.reducedViewport,C=void 0!==R&&R,T=e.canShowStats,N=Object(o.useState)({opacity:1,translate:0}),I=Object(s.a)(N,2),_=I[0],L=I[1],z=Object(o.useState)(!1),F=Object(s.a)(z,2),B=F[0],U=F[1],P=Object(o.useState)(null),H=Object(s.a)(P,2),V=H[0],W=H[1];Object(o.useEffect)((function(){W(null)}),[i,n,a]);var G=Object(o.createRef)();Object(o.useEffect)((function(){G.current&&(G.current.scrollTop=0)}),[i]);var Y=Object(E.b)(Object(m.a)({config:{duration:350,easing:h.a},onRest:function(){var e=B||{},t=e.next,n=e.actions,a=e.conditions;_.immediate?(U(null),L({opacity:1,translate:0,immediate:!1}),u(t,n,a)):_&&0===_.opacity&&L({opacity:0,translate:100,immediate:!0})}},_)),J=Y.opacity,K=Y.translate,Z=function(e){f(),U(e),L({opacity:0,translate:-100})},X=Object(m.a)({opacity:J,transform:K.interpolate((function(e){return k(b.styles.animations?b.styles.animations.sequence:null)(e)}))},v.textStyle),$=function(){var e=i.choices.filter((function(e){return!(r=e).showCondition||!r.showCondition.kind||q(t,n,a,r.showCondition);var r}));return e.length>0?e.map((function(e,n){var a=(e.themeId?Q(t,e.themeId):v).button;return c.a.createElement("div",{key:"choice-"+n},c.a.createElement("button",{style:a,onClick:function(){return Z(e)}},c.a.createElement("div",{dangerouslySetInnerHTML:{__html:M(D(fe(e.content)))}})))})):c.a.createElement("button",{style:v.button,onClick:j},c.a.createElement(g.a,{name:"caret left",style:{margin:0}}))},ee=function(e){var t=i.puzzle&&i.puzzle.codes?i.puzzle.codes.find((function(t){return t.value.toUpperCase()===e.toUpperCase()})):null;t?Z({next:t.next}):i.puzzle&&i.puzzle.defaultNext?Z({next:i.puzzle.defaultNext}):console.log("No link defined for this code. Check your sequence !")},ne=function(e){var t=e.icon,n=e.big,a=e.label,r=Object(d.a)(e,["icon","big","label"]);return c.a.createElement("button",Object.assign({style:Object(m.a)({},v.button,{padding:n?".7em 1em":".5em 1em",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",borderRadius:".6em",width:C?n?"5em":"6em":"18vmin",minWidth:n?70:64,margin:"0.5em .3em"})},r),c.a.createElement(g.a,{name:t,style:{fontSize:n?"1.8em":"1.4em",margin:"0 0 5px"}}),"  ",c.a.createElement("span",{style:{fontSize:n?"1em":".8em"}},a))},oe=function(){x?x():Z(i)},le=function(e){var t=e.strings;return c.a.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"}},c.a.createElement(ne,{id:"bt-replay",icon:"repeat",disabled:!y,onClick:oe,label:t.RETRY}),O&&S&&c.a.createElement(ne,{id:"bt-rate",disabled:!y,icon:"star",onClick:O,label:t.REVIEWS,big:!0}),T&&c.a.createElement(ne,{id:"bt-stats",icon:"chart pie",disabled:!y,onClick:y,label:t.STATS}))},ie=function(e){var t=e.strings;return c.a.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"}},c.a.createElement(ne,{id:"bt-replay",icon:"repeat",disabled:!y,onClick:oe,label:t.RETRY}),j&&w&&c.a.createElement(ne,{id:"bt-lastchoice",icon:"angle double left",disabled:!y,onClick:j,label:t.BACK,big:!0}),T&&c.a.createElement(ne,{id:"bt-stats",icon:"chart pie",disabled:!y,onClick:y,label:t.STATS}))},se=i.image&&t.images&&t.images[i.image.id]||{},ue=se.urlLocal||se.url,me={src:ue,size:i.image&&i.image.size?i.image.size:"medium",circular:!1,rounded:!0},de=ue&&c.a.createElement("div",{style:{display:"flex",justifyContent:"center"}},c.a.createElement("div",{style:{position:"relative",margin:"auto"}},c.a.createElement(p.a,Object.assign({style:Object(m.a)({margin:".5em",maxWidth:270,maxHeight:i.puzzle?160:"inherit"},i.puzzle?{width:"auto"}:{})},me)),!V&&i.image.allowZoom&&c.a.createElement("div",{style:Object(m.a)({},ae,{background:v&&v.sequenceStyles?v.sequenceStyles.background:"#000"})},c.a.createElement("button",{style:Object(m.a)({},v.button,{},re),onClick:function(){return W(me.src)}},c.a.createElement(g.a,{name:"zoom-in",fitted:!0}))))),fe=function(e){for(var a,r=/<span class="ql-moikivar"([^<]+)<\/span>/gim,o=/data-var-id="([A-Za-z0-9-]+)" data-var-op="([a-z]+)"/,c=[],i=n.counters||[],s=n.textvars||[],u=0,m=function(){var e=a[0].match(o);if(e&&e.length>1){var n=i.find((function(t){return t.id===e[1]}))||t.counters[e[1]],r=s.find((function(t){return t.id===e[1]}))||t.textvars[e[1]],m=e[2]||"value",d="";if(n)switch(m){case"percent":var f=n.value||0,b=t.counters[n.id];d=Math.round((f-b.min)/(b.max-b.min)*100)+"%";break;default:d=void 0!==n.value?n.value.toString():n.defaultValue.toString()}else if(r){var g=t.textvars[r.id];switch(m){case"random":g.values&&g.values.length>0?(d=g.values[Math.round(l[u]*(g.values.length-1))].text,++u>l.length&&(u=0)):d=r.name;break;default:if(d=r.name,g&&g.values&&g.values.length>0){var v=g.values.find((function(e){return e.id===r.value}));d=v?v.text:g.values[0].text}}}c.push({from:a[0],to:d})}};null!==(a=r.exec(e));)m();for(var d=e,f=0;f<c.length;++f)d=d.replace(c[f].from,c[f].to);return d};return c.a.createElement(A.Consumer,null,(function(e){return c.a.createElement(o.Fragment,null,c.a.createElement(E.a.div,{className:"sequence",style:X},i&&c.a.createElement(o.Fragment,null,!(i.noContent&&i.puzzle&&!i.image)&&c.a.createElement("div",{className:"sequence-content-wrapper"},c.a.createElement("div",{className:"sequence-content",style:{borderRadius:i.noContent?0:"1.5em"}},i.noContent?i.image&&c.a.createElement("div",{style:{display:"flex",justifyContent:"center",padding:0,background:"none",borderRadius:0}},c.a.createElement("div",{style:{position:"relative"}},c.a.createElement(p.a,Object.assign({style:{width:"auto",height:"auto",maxHeight:"100%"}},me)),!V&&i.image.allowZoom&&c.a.createElement("div",{style:Object(m.a)({},ae,{background:v&&v.sequenceStyles?v.sequenceStyles.background:"#000"})},c.a.createElement("button",{style:Object(m.a)({},v.button,{},re),onClick:function(){return W(me.src)}},c.a.createElement(g.a,{name:"zoom-in",fitted:!0}))))):c.a.createElement("div",{ref:G,style:v.sequence},i.image&&i.image.isBefore&&de,c.a.createElement("div",{dangerouslySetInnerHTML:{__html:M(D(fe(i.content)))}}),i.image&&!i.image.isBefore&&de),i.final&&!i.hasOwnProperty("routineExitLabel")&&i.httplink&&c.a.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",background:"none"}},c.a.createElement("button",{style:v.button,onClick:function(){return window.open(i.httplink)}},c.a.createElement(g.a,{name:"linkify"}),i.httplabel)))),c.a.createElement("div",{className:"sequence-actions",style:i.puzzle?{flexGrow:1}:{}},i.puzzle?c.a.createElement(te,{resetCode:0===_.opacity,styles:v,puzzle:i.puzzle,onCodeEntered:ee}):c.a.createElement(o.Fragment,null,i.choices&&i.choices.length>0?c.a.createElement($,null):c.a.createElement(o.Fragment,null,(i.final||!i.next)&&i.hasOwnProperty("routineExitLabel")&&r&&r.find((function(e){return e.from===i.id&&!!e.next}))?c.a.createElement("div",null,c.a.createElement("button",{style:v.button,onClick:function(){return Z(i)}},c.a.createElement(g.a,{name:"caret right",style:{margin:0}}))):c.a.createElement(o.Fragment,null,i.final||!i.next?c.a.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"}},i.isHappyEnd?c.a.createElement(le,{strings:e}):c.a.createElement(ie,{strings:e,undo:j,canUndo:w})):c.a.createElement("button",{style:v.button,onClick:function(){return Z(i)}},c.a.createElement(g.a,{name:"caret right",style:{margin:0}})))))))),V&&c.a.createElement(ce,{styles:v,image:V,onClose:function(){return W(null)}}))}))},ie=n(338),se=window.XMLHttpRequest.prototype.open,ue=window.XMLHttpRequest.prototype.send,me=function(){window.XMLHttpRequest.prototype.open=se,window.XMLHttpRequest.prototype.send=ue},de=function(e){return e&&e.localFile?e.localFile:e&&e.previews?e.previews["preview-lq-mp3"]:null},fe=Object(o.forwardRef)((function(e,t){var n=e.sound,a=e.isLoop,r=e.onLoad,l=de(n),i=Object(ie.a)(l),u=Object(s.a)(i,2)[1];return Object(o.useImperativeHandle)(t,(function(){return u})),Object(o.useEffect)((function(){return u.sound&&(u.sound.loop(a),"loaded"===u.sound.state()&&r(l),u.sound.on("load",(function(){r(l)})),u.sound.on("fade",(function(){0===u.sound.volume()&&u.sound.stop()}))),function(){u.sound&&(u.sound.off(),u.sound.stop())}}),[u.sound,l]),c.a.createElement(o.Fragment,null)})),be=!1,ge=Object(o.forwardRef)((function(e,t){var n=e.sounds,a=e.onReady,r=e.onProgress,l=Object.entries(n).map((function(e){var t=Object(s.a)(e,2);t[0];return t[1]}))||[],i=Object(o.useState)(null),u=Object(s.a)(i,2),m=u[0],d=u[1],b=Object(o.useState)(null),g=Object(s.a)(b,2),v=g[0],y=g[1],E=Object(o.useState)([]),p=Object(s.a)(E,2),h=p[0],O=p[1],S=Object(o.useState)(!1),j=Object(s.a)(S,2),k=j[0],w=j[1],x=Object(o.useRef)({});l.forEach((function(e){var t=e.id;x.current[t]=null}));var R=0,C=function(e){var t=T.find((function(t){return t.url===e}));t&&(t.loaded=100),++R===l.length&&(a(),me())},T=l.map((function(e){var t=e.sound,n=e.id;return{url:de(t),loaded:0,id:n}}));return Object(o.useEffect)((function(){var e;return be=!1,e=function(e,t){var n=T.find((function(t){return t.url===e}));if(n){n.loaded=t;var a=0;T.forEach((function(e){return a+=e.loaded}));var o=a/T.length;r(o),100===o&&me()}},window.XMLHttpRequest.prototype.open=function(){var e=Array.prototype.slice.call(arguments),t=e[0],n=e[1];return this.method=t,this.requestURL=n,se.apply(this,arguments)},window.XMLHttpRequest.prototype.send=function(){return this.addEventListener("error",(function(t){e&&e(t.target.requestURL,100)})),this.onprogress=function(t){if(e){var n=t.loaded/t.total*100;e(t.target.requestURL,n)}},ue.apply(this,arguments)},function(){me(),be=!0}}),[]),Object(o.useImperativeHandle)(t,(function(){return{getIsPaused:function(){return k},addPausedSound:function(e){O([].concat(Object(f.a)(h),[e]))},getCurrentLoop:function(){return{sound:m,params:v}},playSound:function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e){var a=e.sound,r=e.params;if("stop"===a){if(m&&x.current[m]){var o=x.current[m].sound;o.fade(1,0,3),d(null),y(null)}}else if(x.current[a]&&x.current[a].sound){var c=x.current[a].sound;if(n){if(m&&m!==a){var l=x.current[m].sound;l.fade(1,0,6),c.fade(0,1,6)}else m?(c.stop(),c.volume(1)):c.volume(1);d(a),y(r)}e.params&&e.params.volume&&c.volume(e.params.volume),e.params&&e.params.delay?setTimeout((function(){!be&&t.current&&(t.current.getIsPaused()?t.current.addPausedSound({id:e.sound,time:0}):c.play())}),1e3*e.params.delay):c.play()}}},fadeLoop:function(){m&&x.current[m].sound.fade(1,0,2)},stopAllSounds:function(){O([]),l.forEach((function(e){var t=e.id,n=x.current[t];n&&n.sound&&n.sound.stop()}))},togglePause:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(k)e||h.forEach((function(e){var t=e.id,n=e.time,a=x.current[t];a&&a.sound&&(a.sound.seek(n),a.sound.play())})),O([]);else{var t=[];l.forEach((function(e){var n=e.id,a=x.current[n];a&&a.sound&&a.sound.playing()&&(t.push({id:n,time:a.sound.seek()}),a.sound.stop())})),O(t)}w(!k)}}})),c.a.createElement(o.Fragment,null,l.map((function(e){return c.a.createElement(fe,Object.assign({key:"snd-"+e.id,ref:function(t){return x.current[e.id]=t},onLoad:C},e))})))})),ve=n(350),ye=function(e){var t,n=e.svg;return c.a.createElement("div",{className:"fallback",dangerouslySetInnerHTML:{__html:(t=n,Object(L.sanitize)(t))}})},Ee=function(e){var t=e.icon,n=e.className,a=void 0===n?"":n,r=e.style,o=void 0===r?{}:r,l=t&&t.split("svg+xml,"),i=l&&2===l.length?decodeURIComponent(l[1]):t;return c.a.createElement(ve.a,{src:i&&!i.startsWith("<svg ")?i:"",className:a,style:o,fallback:function(){return c.a.createElement(ye,{svg:i})}})},pe=(n(621),function(e){var t=e.params,n=e.theme,a=e.onClosed,r=e.textStyle,l=Object(o.useState)(!1),i=Object(s.a)(l,2),u=i[0],d=i[1],f=S(n.styles.animations?n.styles.animations.objectModal:null),b=n.styles.animations?n.styles.animations.objectModalDecorator:null,g=Object(E.c)(u,null,Object(m.a)({},f,{onRest:function(){t&&!u&&a()}}));Object(o.useEffect)((function(){if(t){d(!0);var e=setTimeout((function(){d(!1)}),1e3*(t.asset.duration||2));return function(){return clearTimeout(e)}}}),[t]);return t&&c.a.createElement("div",{className:"object-modal-container",style:Object(m.a)({fontFamily:n.styles.fontFamily},r),onClick:function(){d(!1)}},g.map((function(e){var a=e.item,r=e.key,o=e.props;return a&&c.a.createElement(E.a.div,{key:r,style:o,className:"object-modal-wrapper"},c.a.createElement("div",{className:"object-modal",style:{background:n.styles.sequenceBackground}},function(){var e=t.asset?t.asset.icon:null;return e?c.a.createElement(Ee,{className:"modal-icon",icon:e,style:{fill:n.styles.sequenceText,stroke:n.styles.sequenceText}}):null}(),t.asset&&t.asset.desc&&c.a.createElement("div",{className:"object-modal-label",style:{marginTop:".5em",color:n.styles.sequenceText},dangerouslySetInnerHTML:{__html:D(t.asset.desc)}})))})),"star"===b&&c.a.createElement("div",{className:"object-modal-star"},c.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"699.936",height:"699.936",viewBox:"0 0 699.936 699.936"},c.a.createElement("path",{opacity:".7",fill:n.styles.animations.objectModalDecoratorColor||"#FCEE21",d:"M349.968 199.968L404.72 4.277l-8.4 203.032L508.864 38.115l-70.728 190.5L597.455 102.48 471.32 261.8l190.5-70.729-169.194 112.544 203.033-8.399-195.691 54.752 195.691 54.752-203.033-8.4 169.193 112.544-190.499-70.728 126.135 159.319L438.136 471.32l70.728 190.5L396.32 492.626l8.4 203.033-54.752-195.691-54.752 195.691 8.399-203.033L191.071 661.82l70.729-190.5-159.32 126.135 126.135-159.319-190.5 70.728L207.309 396.32l-203.032 8.4 195.691-54.752L4.277 295.216l203.032 8.399L38.116 191.071 228.615 261.8 102.48 102.48 261.8 228.615l-70.729-190.5 112.544 169.194-8.399-203.032z"}))))}),he=n(677),Oe=n(676),Se=n(671),je=n(672),ke=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:260,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e&&e.length>t){if(n){var a=e.slice(0,t);return(a=a.slice(0,a.lastIndexOf(" ")))+"..."}return e.substring(0,t)+"..."}return e},we=function(e){var t=e.strings,n=e.story,a=function(e){if(e&&e.author){var t=e.author,n=t.firstname,a=t.lastname,r=t.pseudo,o=t.socialClubProfile;if(r)return r;if(n&&a)return n+" "+a;if(o&&o.slug)return"@"+o.slug}return"Inconnu"}(n.meta);return c.a.createElement("div",{style:{fontStyle:"italic",color:"#9e9a9a",marginBottom:"1em"}},n.meta.originalAuthor?c.a.createElement(o.Fragment,null,c.a.createElement("span",null,t.STORY_BY," ",n.meta.originalAuthor),c.a.createElement("br",null),c.a.createElement("span",null,"(",t.ADAPTED_BY," ",a,")")):t.STORY_BY+" "+a)},xe=function(e){var t=e.story,n=e.showIfid,a=void 0===n||n;return c.a.createElement(A.Consumer,null,(function(e){return c.a.createElement(o.Fragment,null,c.a.createElement("div",{style:{fontStyle:"italic"}},e.PRESENT),c.a.createElement("h2",{style:{marginTop:"0.3em",marginBottom:"0.3em"}},z(t.meta.name)),c.a.createElement(we,{strings:e,story:t}),t.meta.ifid&&a&&c.a.createElement("div",{style:{fontStyle:"italic",fontSize:".8em",userSelect:"text",margin:"-10px -25px 5px",textAlign:"center",color:"#8a8a8a"}},"IFID : ",t.meta.ifid))}))},Re=n(342),Ce=(new Date).getFullYear(),Te=function(){return c.a.createElement("div",{style:{width:"100%",textAlign:"center",position:"absolute",fontStyle:"italic",fontSize:".8em",color:"#999",bottom:10,left:0}},"Moiki \xa9 ",Ce," - v.",Re.a)},Ne=function(e){var t=e.story,n=e.soundsLoaded,a=e.soundsProgress,r=e.onStart,l=e.onShowCredits,i=t.sounds&&Object.keys(t.sounds).length>0,u=!0;navigator&&navigator.userAgent&&(-1!==navigator.userAgent.indexOf("Nintendo")||-1!==navigator.userAgent.indexOf("Tesla"))&&(u=!1);var m=!u||n||!i||100===(a||0).toFixed(0);return Object(o.useEffect)((function(){if(t){var e,n=Object.entries(t.images).map((function(e){var t=Object(s.a)(e,2);t[0];return t[1]})),a=Object(b.a)(n);try{for(a.s();!(e=a.n()).done;){var r=e.value;(new Image).src=r.urlLocal||r.url}}catch(o){a.e(o)}finally{a.f()}}}),[t]),c.a.createElement(A.Consumer,null,(function(e){return c.a.createElement(he.a,{id:"story-start-screen",inverted:!0,padded:"very",style:{width:350,padding:"2.5em 3em"}},t?c.a.createElement(o.Fragment,null,c.a.createElement(xe,{story:t,showIfid:!1}),(t.meta.imageLocal||t.meta.image)&&c.a.createElement("div",null,c.a.createElement("img",{style:{maxHeight:225,overflow:"hidden",width:"100%"},src:t.meta.imageLocal||t.meta.image,alt:"",className:"cover"})),c.a.createElement("p",{style:{marginTop:"0.3em"}},ke(z(t.meta.description),260,!0)),c.a.createElement("div",{style:{height:"3em",display:"flex",justifyContent:"center",alignItems:"center"}},m?c.a.createElement(Oe.a,{id:"play-button",onClick:function(){return r({sounds:!0})},primary:!0,icon:"play",circular:!0,size:"huge",style:{margin:".75em"}}):c.a.createElement(he.a,{inverted:!0,style:{margin:"1em",color:"#9e9a9a"}},c.a.createElement("div",null,e.LOADING_SOUNDS,c.a.createElement("br",null),a.toFixed(0),"%"),c.a.createElement("div",{style:{width:"100%",height:4,position:"relative",background:"#666",display:"block",borderRadius:"2px",overflow:"hidden"}},c.a.createElement("div",{style:{height:"100%",width:a+"%",background:"#2185D0",display:"block"}})))),c.a.createElement(Se.a,{inverted:!0}),c.a.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"}},c.a.createElement(Oe.a,{id:"credits-button",className:"link-button",basic:!0,inverted:!0,size:"mini",onClick:l},e.SHOW_CREDITS))):c.a.createElement(je.a,{active:!0}),c.a.createElement(Te,null))}))},qe=n(343),Ie=(n(622),function(e){var t=e.story,n=e.stats,a=e.onReset,r=e.onClose,l=e.onShowCredits,i=e.onRestart,s=n.numSequencesShown,u=n.numSequencesTotal,m=n.numHeroesShown,d=n.numHeroesTotal,f=n.numObjectsShown,b=n.numObjectsTotal,g=n.numUndo,v=n.numReplays,y=n.numVictories,E=n.numDefeats,p=Math.round(s/u*100),h=-1;d>0&&(h=Math.round(m/d*100));var O=-1;b>0&&(O=Math.round(f/b*100));var S=0;return S=h>=0&&O>=0?(p+(h+O)/2)/2:h<0&&O<0?p:(p+h+O+1)/2,c.a.createElement(A.Consumer,null,(function(e){return c.a.createElement(he.a,{inverted:!0,padded:"very",style:{width:350}},c.a.createElement(Oe.a,{primary:!0,circular:!0,icon:"close",onClick:r,style:{position:"absolute",top:10,right:10}}),c.a.createElement(Se.a,{inverted:!0,horizontal:!0,style:{marginTop:0}},e.PROGRESSION),c.a.createElement("div",{style:{width:70,height:70,margin:"1em auto"}},c.a.createElement(qe.a,{value:S,text:"".concat(Math.round(S),"%"),strokeWidth:10,styles:{text:{fontSize:"2em",fontWeight:"bold"}}})),c.a.createElement("div",null,e.SEQ_FOUND," ",c.a.createElement("b",null,"".concat(s," / ").concat(u))),d>0&&c.a.createElement("div",null,e.HEROES_FOUND," ",c.a.createElement("b",null,"".concat(m," / ").concat(d))),b>0&&c.a.createElement("div",null,e.OBJ_FOUND," ",c.a.createElement("b",null,"".concat(f," / ").concat(b))),c.a.createElement(Se.a,{inverted:!0,horizontal:!0},e.STATS),t.meta&&t.meta.options.allowBack&&c.a.createElement("div",null,e.NUM_UNDO," ",c.a.createElement("b",null,g)),c.a.createElement("div",null,e.NUM_GAMES," ",c.a.createElement("b",null,v)),c.a.createElement("div",null,e.NUM_VICTORIES," ",c.a.createElement("b",null,y)),c.a.createElement("div",null,e.NUM_DEFEATS," ",c.a.createElement("b",null,E)),c.a.createElement(Se.a,null),c.a.createElement(o.Fragment,null,c.a.createElement(Oe.a,{size:"large",inverted:!0,circular:!0,icon:"repeat",content:e.RESTART,onClick:i,style:{marginBottom:"1em"}}),c.a.createElement("br",null)),c.a.createElement(Oe.a,{size:"small",inverted:!0,circular:!0,content:e.RESET,onClick:a}),c.a.createElement(Se.a,{inverted:!0}),c.a.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"}},c.a.createElement(Oe.a,{className:"link-button",basic:!0,inverted:!0,size:"mini",onClick:l},e.SHOW_CREDITS)),c.a.createElement(Te,null))}))}),_e=function(e){var t=e.story,n=e.onClose,a=function(e){return-1!==e.indexOf("/by-nc/")?"BY-NC":-1!==e.indexOf("/zero/")?"CC":-1!==e.indexOf("/by/")||"creative-commons-attribution"===e?"BY":"public-domain"===e?"public":"???"},r=window.story_hooks?window.story_hooks.sounds:{},l=Object.entries(t.images).map((function(e){var t=Object(s.a)(e,2);t[0];return t[1]})),i=Object.entries(t.assets).map((function(e){var t=Object(s.a)(e,2);t[0];return t[1]})),u=i.filter((function(e){var t=e.info;return t&&t.license})).map((function(e){var t=e.icon,n=e.info;return{icon:t,attribution:n.attribution,license:a(n.license)}})),m=Object.entries(t.sounds).map((function(e){var t=Object(s.a)(e,2);t[0];return t[1]})),d=m.filter((function(e){var t=e.sound;return t.username&&t.name&&t.license})).map((function(e){var t=e.sound;return{name:t.name,username:t.username,license:a(t.license),file:t.localFile.slice(t.localFile.indexOf("/")+1)}})),f=t.meta.imageInfo&&(t.meta.imageInfo.user||t.meta.imageInfo.ikFileId);return c.a.createElement(A.Consumer,null,(function(e){return c.a.createElement(he.a,{inverted:!0,padded:"very",style:{width:350,padding:"3em 1em"}},c.a.createElement(Oe.a,{basic:!0,inverted:!0,circular:!0,icon:"arrow left",onClick:n,style:{position:"absolute",top:10,left:10}}),t?c.a.createElement(o.Fragment,null,c.a.createElement(xe,{story:t}),c.a.createElement(Se.a,{style:{marginTop:"2.5em"},inverted:!0,horizontal:!0},e.CREDITS),c.a.createElement("div",{style:{minHeight:130,maxHeight:192,overflowY:"auto"}},t.meta.customCredits&&(t.meta.customCredits.content||t.meta.customCredits.link)&&c.a.createElement("div",null,t.meta.customCredits.content&&c.a.createElement("div",null,ke(t.meta.customCredits.content,260,!0)),c.a.createElement("div",{style:{margin:".5em"}},t.meta.customCredits.link&&c.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:t.meta.customCredits.link},t.meta.customCredits.imgLink?c.a.createElement("img",{style:{maxWidth:120,overflow:"hidden",width:"auto",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"cover"},src:t.meta.customCredits.imgLink,alt:"",className:"cover"}):e.READ_MORE)),c.a.createElement("div",{style:{display:"block",height:1,background:"rgba(255, 255, 255, 0.15)"}})),f&&c.a.createElement(o.Fragment,null,c.a.createElement("h4",null,e.COVER),c.a.createElement(p.a,{style:{margin:".4em auto"},src:t.meta.imageLocal||t.meta.image,size:"small",rounded:!0}),t.meta.imageInfo&&t.meta.imageInfo.user?c.a.createElement("div",null,"by ",c.a.createElement("a",{href:t.meta.imageInfo.hotlink,target:"_blank",rel:"noreferrer noopener"},t.meta.imageInfo.user),c.a.createElement("div",{style:{fontStyle:"italic",color:"#9e9a9a"}},"(",c.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"https://unsplash.com/?utm_source=Moiki&utm_medium=moiki.fr"},"Unsplash"),")")):c.a.createElement("div",{style:{fontStyle:"italic",color:"#9e9a9a"}},t.meta.imageInfo&&t.meta.imageInfo.ikFileId?c.a.createElement("div",null,t.meta.imageInfo.customCredit||e.ALL_RIGHTS_RESERVED):c.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"https://unsplash.com/?utm_source=Moiki&utm_medium=moiki.fr"},"Unsplash"))),l&&l.length>0&&c.a.createElement("div",{className:"credits-assets-list"},f&&c.a.createElement(Se.a,null),c.a.createElement("h4",{style:{marginTop:"1em"}},e.IMAGES),c.a.createElement("div",{style:{fontStyle:"italic",color:"#9e9a9a"}},l&&l.map((function(t){return c.a.createElement("div",{style:{marginBottom:"1em"}},c.a.createElement(p.a,{style:{margin:".4em auto"},src:t.urlLocal||t.url,size:"tiny",rounded:!0}),c.a.createElement("div",null,t.imageInfo.customCredit||e.ALL_RIGHTS_RESERVED))})))),i&&i.length>0&&c.a.createElement("div",{className:"credits-assets-list"},f&&c.a.createElement(Se.a,null),c.a.createElement("h4",{style:{marginTop:"1em"}},e.ICONS),c.a.createElement("div",{style:{fontStyle:"italic",marginBottom:"1em",color:"#9e9a9a"}},e.ICONS_FROM,c.a.createElement("br",null),c.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"https://thenounproject.com/"},"The Noun Project")),u&&u.map((function(t,n){var a=t.icon,r=t.attribution,l=t.license;return c.a.createElement(o.Fragment,{key:"icon-credit-"+n},n>0&&c.a.createElement("div",null,"---"),c.a.createElement(Ee,{icon:a,style:{fill:"#fff",stroke:"#fff",margin:0,paddingBottom:".5em",paddingTop:"1em",display:"inline-block"}}),r&&c.a.createElement("div",{style:{overflowWrap:"break-word"}},r),c.a.createElement("div",{style:{fontSize:".7em"}},e.LICENSE," ",l))}))),m&&m.length>0&&c.a.createElement(o.Fragment,null,c.a.createElement(Se.a,null),c.a.createElement("h4",{style:{marginTop:"1em"}},e.SOUNDS),d&&d.map((function(t,n){var a=t.name,l=t.username,i=t.license,s=t.file;return c.a.createElement(o.Fragment,{key:"sound-credit-"+n},n>0&&c.a.createElement("div",null,"---"),s&&r[s]?c.a.createElement(o.Fragment,null,c.a.createElement("div",null,c.a.createElement("em",{style:{overflowWrap:"break-word"}},r[s].credit||a)),r[s].license&&c.a.createElement("div",{style:{color:"#9e9a9a",margin:2}},e.LICENSE," ",r[s].license),r[s].link&&r[s].linkName&&c.a.createElement("div",null,"via ",c.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:r[s].link},r[s].linkName))):c.a.createElement(o.Fragment,null,c.a.createElement("div",null,c.a.createElement("em",{style:{overflowWrap:"break-word"}},a)," by ",l),c.a.createElement("div",{style:{color:"#9e9a9a",margin:2}},e.LICENSE," ",i),c.a.createElement("div",null,"via ",c.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"https://freesound.org/"},"Freesound"))))}))))):c.a.createElement(je.a,{active:!0}),c.a.createElement(Te,null))}))},Le=n(344),ze=n.n(Le),De=(n(623),function(e){var t=e.story,n=e.onClose,a=e.showPlatformInfo,r=t.meta,l=r.description,i=r.image,s=r.imageLocal;return c.a.createElement(A.Consumer,null,(function(e){return c.a.createElement(he.a,{className:"story-about-screen",inverted:!0,padded:"very",style:{width:350,padding:"2.5em 3em"}},c.a.createElement(Oe.a,{primary:!0,circular:!0,icon:"close",onClick:n,style:{position:"absolute",top:10,right:10}}),c.a.createElement(o.Fragment,null,c.a.createElement(xe,{story:t}),(s||i)&&c.a.createElement("div",null,c.a.createElement("img",{style:{maxHeight:225,overflow:"hidden",width:"100%"},src:s||i,alt:"",className:"cover"})),c.a.createElement("p",{style:{marginTop:"0.3em"}},ke(l,260,!0)),a&&c.a.createElement("div",{style:{display:"flex",justifyContent:"space-around",alignItems:"center",color:"#878787"}},c.a.createElement("img",{alt:"moiki logo",src:ze.a,style:{width:50,height:50}}),c.a.createElement("p",{style:{marginLeft:"1em",fontSize:".8em"}},c.a.createElement("em",null,c.a.createElement("a",{href:"https://moiki.fr",target:"_blank",rel:"noreferrer noopener"},"Moiki.fr")," ",e.ITS_FREE)))),c.a.createElement(Te,null))}))}),Me=n(673),Fe=function(e){var t=e.title,n=e.content,a=e.open,r=e.cancelLabel,l=e.onCancel,i=e.confirmLabel,s=e.onConfirm,u=e.confirmIcon,m=void 0===u?null:u,d=e.cancelIcon,f=void 0===d?null:d,b=e.alternate,g=void 0!==b&&b;return c.a.createElement(Me.a,{open:a,dimmer:"blurring",style:{width:300,textAlign:"center"}},c.a.createElement(he.a,{inverted:!0},c.a.createElement("h3",null,t),n&&c.a.createElement(o.Fragment,null,c.a.createElement(Se.a,null),n),c.a.createElement(Se.a,null),g?c.a.createElement("div",{style:{textAlign:"center"}},s&&c.a.createElement(Oe.a,{size:"big",id:"modal-validate-button",color:"blue",onClick:s},m,i),l&&c.a.createElement("div",{style:{margin:"1em auto"}},c.a.createElement("button",{className:"button-link",id:"modal-cancel-button",onClick:l},f,r))):c.a.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",flexWrap:"wrap"}},l&&c.a.createElement(Oe.a,{inverted:!0,id:"modal-cancel-button",onClick:l,style:{marginBottom:5}},f,r),s&&c.a.createElement(Oe.a,{size:"big",id:"modal-validate-button",color:"blue",onClick:s},m,i))))},Ae=(n(624),function(e){var t=e.onClose,n=e.objects,a=e.getAssetById;e.styles;return c.a.createElement(A.Consumer,null,(function(e){return c.a.createElement(he.a,{inverted:!0,padded:"very",style:{width:350}},c.a.createElement(Oe.a,{primary:!0,circular:!0,icon:"close",onClick:t,style:{position:"absolute",top:10,right:10}}),n&&c.a.createElement(Se.a,{inverted:!0,horizontal:!0,style:{marginTop:0}},e.OBJ_WON," (",n.length,")"),c.a.createElement("div",{className:"win-objects-panel"},n&&n.length>0?c.a.createElement("div",{className:"list-objects-container"},n&&n.map((function(e,t){var n=a(e);return c.a.createElement(o.Fragment,{key:"obj-renderer-".concat(t)},t>0&&c.a.createElement(Se.a,null),c.a.createElement("div",{style:{marginBottom:"1em"}},c.a.createElement("div",{style:{color:"#9e9a9a",fontWeight:"bold",fontSize:20}},n.label.trim()),c.a.createElement(Ee,{icon:n.icon,style:{fill:"#fff",stroke:"#fff",margin:0,paddingBottom:".5em",display:"inline-block"}}),c.a.createElement("div",{style:{color:"#fff"}},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.replace(/<span class="ql-moikivar"([^>]+)>([^<]+)<\/span>/gim,"{$2}").replace(/(<([^>]+)>)/gi,"").replace(/&nbsp;/gi," ").replace(/\u200c/gi," ").replace(/([?.:!]{1})(\w)/gi,"$1 $2").replace(/\.\s\.\./gi,"...").trim()}(n.desc).trim())))}))):c.a.createElement("p",null,e.NO_OBJ_WON)))}))}),Be=function(e,t,n){var a=n.kind,r=n.params;switch(a){case"object":return function(e,t,n){var a=n.target,r=n.modifier,o=e.assets[a]||{},c=null,l=!1,i=null,s=null,u=null;if("hero"===o.kind)t.hero===a||"toggle"!==r&&"add"!==r?t.hero!==a||"toggle"!==r&&"sub"!==r||(c=Object(m.a)({},t,{hero:null})):(i=a,u={asset:o},c=Object(m.a)({},t,{hero:a}),l=!0);else if((t.objects||[]).includes(a)||"toggle"!==r&&"add"!==r)!(t.objects||[]).includes(a)||"toggle"!==r&&"sub"!==r||(c=Object(m.a)({},t,{objects:t.objects.filter((function(e){return e!==a}))}));else{s=a,u={asset:o};var d=[].concat(Object(f.a)(t.objects||[]),[a]);c=Object(m.a)({},t,{objects:d}),l=!0}return{gameData:c,sound:l?"objectWin":"objectLose",heroShown:i,objectShown:s,modal:u}}(e,t,r);case"counter":return function(e,t,n){var a,r=n.target,o=n.modifier,c=n.value,l=void 0===c?0:c,i=n.valueType,s=n.minValueType,u=n.minValue,d=n.maxValueType,b=n.maxValue,g=n.animation,v=null,y=e.counters[r]||{},E=Object(f.a)(t.counters||[]);if(!E.find((function(e){return e.id===r})))return console.log("cannot find counter with id: ",r),null;switch(i){case"random":var p,h;switch(s){case"counter":var O=E.find((function(e){return e.id===u}));p=O?O.value:y.min;break;default:p=u||y.min}switch(d){case"counter":var S=E.find((function(e){return e.id===b}));h=S?S.value:y.max;break;default:h=b||y.max}a=Math.floor(Math.random()*(h-p+1))+p,v=g?{randomValue:a}:null;break;case"counter":a=E.find((function(e){return e.id===l})).value||0;break;default:a=l||0}if(isNaN(a)||"number"!==typeof a)return null;var j=null,k=!1;switch(o){case"set":j=E.map((function(e){return e.id===r?{id:e.id,value:Math.max(Math.min(a,y.max),y.min)}:e}));break;case"add":j=E.map((function(e){return e.id===r?{id:e.id,value:Math.min(e.value+a,y.max)}:e}));break;case"sub":j=E.map((function(e){return e.id===r?{id:e.id,value:Math.max(e.value-a,y.min)}:e}));break;default:k=!0}if(!k){var w="counter"+o.slice(0,1).toUpperCase()+o.slice(1);return{gameData:Object(m.a)({},t,{counters:j}),modal:v,sound:w}}return null}(e,t,r);case"textvar":return function(e,t,n){var a,r=n.target,o=n.modifier,c=n.value,l=n.valueType,i=e.textvars[r]||{},s=Object(f.a)(t.textvars||[]),u=s.find((function(e){return e.id===r}));if(!u)return console.log("cannot find textvar with id: ",r),null;switch(l){case"random":var d=i.values?i.values.length:0,b=Math.floor(Math.random()*(d-0+1))+0;a=i.values&&i.values.length>b?i.values[b]:i.values[0];break;case"counter":var g=Object(f.a)(t.counters||[]).find((function(e){return e.id===c})).value||0;a=i.values&&i.values.length>g?i.values[g]:i.values[0];break;default:a=i.values&&i.values.find((function(e){return e.id===c}))}var v=a?a.id:u.name,y=null,E=!1;switch(o){case"set":y=s.map((function(e){return e.id===r?{id:e.id,value:v}:e}));break;default:E=!0}return E?null:{gameData:Object(m.a)({},t,{textvars:y})}}(e,t,r);case"redirect":return{redirectTo:r.target};default:console.log("unknown action ",a)}return null},Ue=function(e){var t=e.counter,n=e.value,a=e.styles;return c.a.createElement("div",{style:a},c.a.createElement("div",null,t.name),c.a.createElement("div",null,isNaN(n)||null===n?t.defaultValue:n))},Pe=function(e){var t=e.counter,n=e.value,a=e.styles;return c.a.createElement("div",{style:a},c.a.createElement("div",null,t.name),c.a.createElement("div",null,isNaN(n)||null===n?t.defaultValue:n," / ",t.max))},He=function(e){var t=e.counter,n=e.value,a=e.styles;return c.a.createElement("div",{style:a},c.a.createElement("div",null,t.name),c.a.createElement("div",null,"".concat((n-t.min)/(t.max-t.min)*100,"%")))},Ve=function(e){var t=e.counter,n=e.value,a=e.styles;return c.a.createElement("div",{style:a},c.a.createElement("div",null,t.name),c.a.createElement("div",{style:{margin:".2em 0",width:100,display:"block",borderRadius:".5em",height:"1em",border:"2px ".concat(a.color," solid"),overflow:"hidden",boxShadow:a.textShadow}},c.a.createElement("div",{style:{width:"".concat((n-t.min)/(t.max-t.min)*100,"%"),display:"block",height:"1em",background:a.color}})))},We=function(e){var t=e.styles,n=e.computedStyles,a=Object(d.a)(e,["styles","computedStyles"]),r=a.gauge,o=Object(d.a)(a,["gauge"]);if(!n.sequence)return null;var l=Object(m.a)({},n.sequence,{},n.textStyle,{color:t.assetsFill,background:"none"});switch(r.kind){case"bar":return c.a.createElement(Ve,Object.assign({},o,{styles:l}));case"percent":return c.a.createElement(He,Object.assign({},o,{styles:l}));case"total":return c.a.createElement(Pe,Object.assign({},o,{styles:l}));default:return c.a.createElement(Ue,Object.assign({},o,{styles:l}))}},Ge=n(346),Ye=n.n(Ge),Je=n(351),Ke=function(e){var t=e.url,n=e.options,a=e.bgStylesFix,r=void 0===a?{}:a,l=Object(o.useState)(t),i=Object(s.a)(l,2),u=i[0],d=i[1],f=Object(o.useState)(t),b=Object(s.a)(f,2),g=b[0],v=b[1],y=Object(o.useState)({}),E=Object(s.a)(y,2),p=E[0],h=E[1],O=Object(Je.a)({variants:{opacity:{from:0,to:1}},initial:t?"visible":"hidden",duration:300});return Object(o.useEffect)((function(){!!g!==!!t&&O.togglePresence(),v(t),t&&d(t)}),[t]),Object(o.useEffect)((function(){if(n){var e={align:{vertical:n.vAlign,horizontal:n.hAlign},styles:{opacity:n.opacity}};n.scale&&"height"===n.scale.base?e.styles=Object(m.a)({},e.styles,{width:"auto",height:n.scale.value+n.scale.kind}):n.scale&&"width"===n.scale.base&&(e.styles=Object(m.a)({},e.styles,{height:"auto",width:n.scale.value+n.scale.kind})),h(e)}else h({})}),[n]),c.a.createElement(o.Fragment,null,O.isRendered&&c.a.createElement("div",{className:"story-background-container",ref:O.ref,style:{position:"absolute",zIndex:0,width:"100%",height:"100%",display:"flex",justifyContent:p.align?p.align.horizontal:"center",alignItems:p.align?p.align.vertical:"center"}},c.a.createElement("img",{alt:"",src:u,style:Object(m.a)({},p.styles,{},r)})))},Ze=function(e){var t=e.theme,n=e.images,a=e.bgStylesFix,r=Object(o.useState)(null),l=Object(s.a)(r,2),i=l[0],u=l[1],m=Object(o.useState)(null),d=Object(s.a)(m,2),f=d[0],b=d[1],g=Object(o.useState)({}),v=Object(s.a)(g,2),y=v[0],E=v[1];return Object(o.useEffect)((function(){a&&"function"===typeof a?E(a(t)):a&&E(a)}),[t,a]),Object(o.useEffect)((function(){n&&t&&t.image&&n[t.image.id]?(u(n[t.image.id].url),b(t.image.options)):u(null)}),[t,n]),c.a.createElement(Ke,{url:i,options:f,bgStylesFix:y})},Xe=(n(625),function(e){var t=e.params,n=e.theme,a=e.onClosed,r=e.textStyle,l=Object(o.useState)(!1),i=Object(s.a)(l,2),u=i[0],d=i[1],f=x(n.styles.animations?n.styles.animations.objectModal:null),b=n.styles.animations?n.styles.animations.objectModalDecorator:null,g=Object(E.c)(u,null,Object(m.a)({},f,{onRest:function(){t&&!u&&a()}}));Object(o.useEffect)((function(){var e=!1;if(t){d(!0);var n=setTimeout((function(){!e&&d(!1)}),2e3);return function(){e=!0,clearTimeout(n)}}}),[t]);return t&&c.a.createElement("div",{className:"random-modal-container",style:Object(m.a)({fontFamily:n.styles.fontFamily},r),onClick:function(){d(!1)}},g.map((function(e){var a=e.item,r=e.key,o=e.props;return a&&c.a.createElement(E.a.div,{key:r,style:o,className:"random-modal-wrapper"},c.a.createElement("div",{className:"random-modal",style:{background:n.styles.sequenceBackground}},t.randomValue&&c.a.createElement("div",{className:"random-modal-label",style:{color:n.styles.sequenceText}},t.randomValue)))})),"star"===b&&c.a.createElement("div",{className:"random-modal-star"},c.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"699.936",height:"699.936",viewBox:"0 0 699.936 699.936"},c.a.createElement("path",{opacity:".7",fill:n.styles.animations.objectModalDecoratorColor||"#FCEE21",d:"M349.968 199.968L404.72 4.277l-8.4 203.032L508.864 38.115l-70.728 190.5L597.455 102.48 471.32 261.8l190.5-70.729-169.194 112.544 203.033-8.399-195.691 54.752 195.691 54.752-203.033-8.4 169.193 112.544-190.499-70.728 126.135 159.319L438.136 471.32l70.728 190.5L396.32 492.626l8.4 203.033-54.752-195.691-54.752 195.691 8.399-203.033L191.071 661.82l70.729-190.5-159.32 126.135 126.135-159.319-190.5 70.728L207.309 396.32l-203.032 8.4 195.691-54.752L4.277 295.216l203.032 8.399L38.116 191.071 228.615 261.8 102.48 102.48 261.8 228.615l-70.729-190.5 112.544 169.194-8.399-203.032z"}))))}),$e=(n(626),function(){return[0,1,2,3,4,5,6,7,8,9].map((function(e){return Math.random()}))}),Qe=!1,et=Object(o.forwardRef)((function(e,t){var n=e.reducedViewport,a=void 0!==n&&n,r=e.bgStylesFix,l=void 0===r?{}:r,i=e.onReady,u=e.onStart,v=e.onSequenceChanged,E=e.onSavePoint,p=e.onSaveReset,h=e.onHappyEnd,O=e.onTragicEnd,S=e.soundsEnabled,j=void 0===S||S,k=e.displayExitButton,w=void 0!==k&&k,x=e.onExit,R=e.showPlatformInfo,C=void 0===R||R,T=e.canShowStats,N=void 0===T||T,_=Object(o.useState)(null),L=Object(s.a)(_,2),z=L[0],D=L[1],M=Object(o.useState)(0),B=Object(s.a)(M,2),U=B[0],P=B[1],H=Object(o.useState)([]),V=Object(s.a)(H,2),W=V[0],G=V[1],Y=Object(o.useState)(0),J=Object(s.a)(Y,2),K=J[0],Z=J[1],ee=Object(o.useState)([]),te=Object(s.a)(ee,2),ne=te[0],ae=te[1],re=Object(o.useState)(0),oe=Object(s.a)(re,2),ce=oe[0],ie=oe[1],se=Object(o.useState)([]),ue=Object(s.a)(se,2),me=ue[0],de=ue[1],fe=Object(o.useState)(null),be=Object(s.a)(fe,2),ve=be[0],ye=be[1],he=Object(o.useState)(null),Oe=Object(s.a)(he,2),Se=Oe[0],je=Oe[1],ke=Object(o.useState)(null),we=Object(s.a)(ke,2),xe=we[0],Re=we[1],Ce=Object(o.useState)(null),Te=Object(s.a)(Ce,2),qe=Te[0],Le=Te[1],ze=Object(o.useState)(null),Me=Object(s.a)(ze,2),Ue=Me[0],Pe=Me[1],He=Object(o.useState)(null),Ve=Object(s.a)(He,2),Ge=Ve[0],Je=Ve[1],Ke=Object(o.useState)(null),et=Object(s.a)(Ke,2),tt=et[0],nt=et[1],at=Object(o.useState)(null),rt=Object(s.a)(at,2),ot=rt[0],ct=rt[1],lt=Object(o.useState)(!e.isPreview),it=Object(s.a)(lt,2),st=it[0],ut=it[1],mt=Object(o.useState)({}),dt=Object(s.a)(mt,2),ft=dt[0],bt=dt[1],gt=Object(o.useState)(!1),vt=Object(s.a)(gt,2),yt=vt[0],Et=vt[1],pt=Object(o.useState)(0),ht=Object(s.a)(pt,2),Ot=ht[0],St=ht[1],jt=Object(o.useState)(0),kt=Object(s.a)(jt,2),wt=kt[0],xt=kt[1],Rt=Object(o.useState)(null),Ct=Object(s.a)(Rt,2),Tt=Ct[0],Nt=Ct[1],qt=Object(o.useState)([]),It=Object(s.a)(qt,2),_t=It[0],Lt=It[1],zt=Object(o.useState)([]),Dt=Object(s.a)(zt,2),Mt=Dt[0],Ft=Dt[1],At=Object(o.useState)([]),Bt=Object(s.a)(At,2),Ut=Bt[0],Pt=Bt[1],Ht=Object(o.useState)(!1),Vt=Object(s.a)(Ht,2),Wt=Vt[0],Gt=Vt[1],Yt=Object(o.useState)(0),Jt=Object(s.a)(Yt,2),Kt=Jt[0],Zt=Jt[1],Xt=Object(o.useState)(0),$t=Object(s.a)(Xt,2),Qt=$t[0],en=$t[1],tn=Object(o.useState)(0),nn=Object(s.a)(tn,2),an=nn[0],rn=nn[1],on=Object(o.useState)(0),cn=Object(s.a)(on,2),ln=cn[0],sn=cn[1],un=Object(o.useState)([]),mn=Object(s.a)(un,2),dn=mn[0],fn=mn[1],bn=Object(o.useState)(!1),gn=Object(s.a)(bn,2),vn=gn[0],yn=gn[1],En=Object(o.useState)(!1),pn=Object(s.a)(En,2),hn=pn[0],On=pn[1],Sn=Object(o.useState)(!1),jn=Object(s.a)(Sn,2),kn=jn[0],wn=jn[1],xn=Object(o.useState)(null),Rn=Object(s.a)(xn,2),Cn=Rn[0],Tn=Rn[1],Nn=Object(o.useState)(null),qn=Object(s.a)(Nn,2),In=qn[0],_n=qn[1],Ln=Object(o.useState)(null),zn=Object(s.a)(Ln,2),Dn=zn[0],Mn=zn[1],Fn=Object(o.useState)({}),An=Object(s.a)(Fn,2),Bn=An[0],Un=An[1],Pn=Object(o.useState)({}),Hn=Object(s.a)(Pn,2),Vn=Hn[0],Wn=Hn[1],Gn=Object(o.useState)({}),Yn=Object(s.a)(Gn,2),Jn=Yn[0],Kn=Yn[1],Zn=Object(o.useState)({}),Xn=Object(s.a)(Zn,2),$n=Xn[0],Qn=Xn[1],ea=Object(o.useState)(null),ta=Object(s.a)(ea,2),na=ta[0],aa=ta[1],ra=Object(o.useState)(null),oa=Object(s.a)(ra,2),ca=oa[0],la=oa[1],ia=Object(o.useState)(0),sa=Object(s.a)(ia,2),ua=sa[0],ma=sa[1];Object(o.useEffect)((function(){if(j||na){if(j&&!na&&ua>0){var t=Date.now()-ua;ma(0),t>12e3&&e.onExit(!0)}}else ma(Date.now())}),[j]);var da=Object(o.useRef)(null);Object(o.useImperativeHandle)(t,(function(){return{updateSequence:ka,loadGame:ba}}));var fa=function(){var t=[];e.story&&e.story.counters&&(t=Object.entries(e.story.counters).map((function(e){var t=Object(s.a)(e,2),n=(t[0],t[1]);return{id:n.id,value:n.defaultValue||0}})));var n=[];return e.story&&e.story.textvars&&(n=Object.entries(e.story.textvars).map((function(e){var t=Object(s.a)(e,2),n=(t[0],t[1]);return{id:n.id,value:n.values&&n.values.length>0?n.values[0].id:n.name}}))),e.defaultGameData?Object(m.a)({counters:t,textvars:n},e.defaultGameData):{counters:t,textvars:n}};Object(o.useEffect)((function(){if(!e.story)throw new Error("No story was given!");var t,n,a=Object(b.a)(e.story.themes);try{var r=function(){var a=n.value;if(a.identifier===(e.story.sequences[e.story.firstSequence].themeId||"default")&&(t=a),"default"===a.identifier){var r=X.find((function(e){return e.name===a.name}))||$;_n(Object(m.a)({},r,{},a))}};for(a.s();!(n=a.n()).done;)r()}catch(u){a.e(u)}finally{a.f()}if(Mn(t),ae([]),de([]),e.story.counters){var o=Object.entries(e.story.counters).map((function(e){var t=Object(s.a)(e,2);t[0];return t[1]}));Tn(o.filter((function(e){return!!e.gauge})))}G([e.story.firstSequence]),ye(e.story.firstSequence),Ft([]),Pt([]),P(Object.entries(e.story.sequences).filter((function(e){var t=Object(s.a)(e,2);t[0];return!t[1].routineId})).filter((function(e){var t=Object(s.a)(e,2),n=(t[0],t[1]);return!(n.final&&n.hasOwnProperty("routineExitLabel"))})).length);var c=Object.entries(e.story.assets).map((function(e){var t=Object(s.a)(e,2);t[0];return t[1]}));Z(c.filter((function(e){return"hero"===e.kind})).map((function(e){return e.id})).length),ie(c.filter((function(e){return"object"===e.kind})).map((function(e){return e.id})).length);var l=fa(),i=e.story.sequences?e.story.sequences[e.story.firstSequence]:null;i&&i.choices&&i.choices.length>0?fn([{id:e.story.firstSequence,path:[e.story.firstSequence],routinesExit:[],eventsDone:[],currentLoop:i.soundLoop&&i.soundLoop.sound?i.soundLoop:null,currentTheme:t||"default",gameData:l,randomSeeds:$e()}]):fn([]),D(e.story),je(l)}),[e.story]),Object(o.useEffect)((function(){z&&0===Kt&&ka()}),[z,Kt]);Object(o.useEffect)((function(){if(v&&v(ve),e.story.sequences&&ve){var t=e.story.sequences[ve];if(t.final&&!t.hasOwnProperty("routineExitLabel")){var n={numReplays:Kt,numVictories:Qt,numDefeats:an,numUndo:ln,numSequencesShown:W.length,percentViewedSequences:(W.length/U).toFixed(2)};t.isHappyEnd&&h?h(n):!t.isHappyEnd&&O&&O(n)}!Qe&&E&&_t&&_t.length>1&&E({data:[].concat(Object(f.a)(dn),[{id:ve,path:_t,currentLoop:da.current?da.current.getCurrentLoop():null,currentTheme:Dn?Dn.identifier:null,gameData:Se,routinesExit:Mt,eventsDone:Ut,randomSeeds:$e()}]),stats:{sequencesShown:W,heroesShown:ne,objectsShown:me,numReplays:Kt,numVictories:Qt,numDefeats:an,numUndo:ln}})}Qe&&(Qe=!1)}),[ve,_t]),Object(o.useEffect)((function(){Qe=!1,xt((new Date).getTime())}),[]),Object(o.useEffect)((function(){var e=(new Date).getTime();if(z){var t=Object.keys(z.sounds||{}).length;if(yt||0===t)Nt(e-wt),i&&i()}}),[yt,z]);var ba=function(e){aa(e)},ga=function(e){return z&&z.sequences?z.sequences[e]:null},va=function(e){var t=Object(o.useRef)();return Object(o.useEffect)((function(){t.current=e})),t.current}({sequenceId:ve});Object(o.useEffect)((function(){var t=ga(ve);if(va&&va.sequenceId!==ve&&(t.final&&!t.hasOwnProperty("routineExitLabel")&&(qa(),t.isHappyEnd&&Bn.sfx&&Bn.sfx.gameWin?Ta(Bn.sfx.gameWin):!t.isHappyEnd&&Bn.sfx&&Bn.sfx.gameLose&&Ta(Bn.sfx.gameLose)),t&&t.soundSfx&&Ta(t.soundSfx),t&&t.soundLoop&&(!t.final||t.hasOwnProperty("routineExitLabel"))&&Ta(t.soundLoop,!0)),t){var n=e.story.themes.find((function(e){return e.identifier===t.themeId}));n&&n.identifier!==(Dn||{}).identifier&&Mn(n)}}),[ve,ga]);var ya=function(e){return z.assets[e]||{}},Ea=function(){ct(ot+1)};Object(o.useEffect)((function(){var e=tt||{},t=e.events,n=e.id,a=e.conditions;t&&(ot||0===ot)&&(t.length>ot?function(e){if(e.condition&&q(z,Se,_t,e.condition)&&("once"===e.kind&&Pt([].concat(Object(f.a)(Ut),[e.id])),e.actions&&e.actions.length>0)){var t=Oa(e.actions[0]);if(!t)return;"string"===typeof t&&z.sequences[t]&&(Ft([]),nt({id:t,conditions:[],events:tt.events}))}Ea()}(t[ot]):(nt(null),ct(null),ka(n,a)))}),[tt,ot]);var pa=function(e,t){var n=z.events.filter((function(e){return!Ut.includes(e.id)}));nt({id:e,conditions:t,events:n}),ct(0)},ha=function(){Je(Ge+1)},Oa=function(e){var t=Be(z,Se,e);if(t){if(t.heroShown&&!ne.includes(t.heroShown)&&ae([].concat(Object(f.a)(ne),[t.heroShown])),t.objectShown&&!me.includes(t.objectShown)&&de([].concat(Object(f.a)(me),[t.objectShown])),t.sound&&Bn.sfx&&Bn.sfx[t.sound]&&Ta(Bn.sfx[t.sound]),t.gameData&&je(t.gameData),t.modal)return t.modal.asset?Re(t.modal):t.modal.randomValue&&Le(t.modal),!1;if(t.redirectTo)return t.redirectTo}return!0};Object(o.useEffect)((function(){var e,t=Ue||{},n=t.actions,a=t.id,r=t.conditions;n&&(Ge||0===Ge)&&(n.length>Ge?(e=n[Ge],Oa(e)&&ha()):(Pe(null),Je(null),z.events&&z.events.length>0?pa(a,r):ka(a,r)))}),[Ue,Ge]);var Sa=function(e,t,n){Pe({id:e,actions:t,conditions:n}),Je(0)},ja=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;t&&t.length>0?Sa(e,t,n):z.events&&z.events.length>0?pa(e,n):ka(e,n,a)},ka=function(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t)return Zt(Kt+1),0===W.length&&G([z.firstSequence]),z.sequences[z.firstSequence]&&z.sequences[z.firstSequence].choices&&z.sequences[z.firstSequence].choices.length>0?fn([{id:z.firstSequence,path:[z.firstSequence],routinesExit:[],eventsDone:[],currentLoop:z.sequences[z.firstSequence].soundLoop&&z.sequences[z.firstSequence].soundLoop.sound?z.sequences[z.firstSequence].soundLoop:null,currentTheme:z.sequences[z.firstSequence].themeId||"default",gameData:Se,randomSeeds:$e()}]):fn([]),Ft([]),Pt([]),Lt([z.firstSequence]),je(fa()),ye(z.firstSequence),Na(),void Ia(ft);var r=t;if(n&&n.length>0){var o=I(z,Se,_t,n);o&&(r=o)}var c=a||Mt,l=z.sequences[r]&&z.sequences[r].redirectTo?z.sequences[r].redirectTo:r,i=[].concat(Object(f.a)(_t),[r]),s=c;if(l!==r&&(i=[].concat(Object(f.a)(_t),[r,l]),s=[].concat(Object(f.a)(c),[z.sequences[r].routineExit]),Ft(s)),z.sequences[l]&&z.sequences[l].final&&c&&c.length>0){var u=c[c.length-1].find((function(e){return e.from===l}));if(u)return s=c.slice(0,-1),Ft(s),void ja(u.next,u.actions,u.conditions,s)}Lt(i),W.includes(l)||G([].concat(Object(f.a)(W),[l])),z.sequences[l]&&z.sequences[l].final&&!z.sequences[l].hasOwnProperty("routineExitLabel")&&(z.sequences[l].isHappyEnd?en(Qt+1):rn(an+1));var m=z.sequences[l]&&z.sequences[l].themeId;if(m){var d=e.story.themes.find((function(e){return e.identifier===m}));d&&d.identifier!==(Dn||{}).identifier&&Mn(d)}if(ye(l),z.sequences[l]&&z.sequences[l].choices&&z.sequences[l].choices.length>0){var b=[].concat(Object(f.a)(dn),[{id:l,path:i,routinesExit:s,eventsDone:Ut,currentLoop:da.current?da.current.getCurrentLoop():null,currentTheme:m||(Dn?Dn.identifier:null),gameData:Se,randomSeeds:$e()}]);fn(b)}},wa=function(e,t){return e.length===t.length&&e.every((function(e,n){return e===t[n]}))},xa=function(){var t=dn[dn.length-1];if(wa(_t,t.path)){var n=dn.slice(0,-1);if(0===n.length)return;fn(n),t=dn[dn.length-2]}Na();var a=t,r=a.id,o=a.path,c=a.gameData,l=a.currentLoop,i=a.currentTheme,s=a.routinesExit,u=a.eventsDone,m=e.story.themes.find((function(e){return e.identifier===(i||"default")}));Mn(m),je(c),Lt(o),Ft(s),Pt(u),sn(ln+1),l&&Ta(l,!0),ye(r)},Ra=function(){Re(null),Le(null),null!==ot?Ea():ha()};Object(o.useEffect)((function(){if(Dn){var t=Q(z,Dn.identifier),n=t.sequenceStyles,a=t.textStyle;Un(n),Wn(Object(m.a)({background:n.background,fontFamily:n.fontFamily},e.styles||{})),Qn(a),Kn(t)}}),[Dn]);var Ca,Ta=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];da.current&&da.current.playSound(e,t)},Na=function(){da.current&&ft.sounds&&da.current.stopAllSounds()},qa=function(){da.current&&ft.sounds&&da.current.fadeLoop()},Ia=function(t){Na();var n=e.story.sequences?e.story.sequences[e.story.firstSequence]:null;t.sounds&&!e.isPreview&&da.current&&n&&n.soundLoop&&n.soundLoop.sound&&da.current.playSound(n.soundLoop,!0);var a="default";n&&n.themeId&&(a=n.themeId);var r=e.story.themes.find((function(e){return e.identifier===a}));r&&r.identifier!==(Dn||{}).identifier&&Mn(r)},_a=function(e){u&&u(Tt),ut(!1),bt(e),Zt(1),Ia(e)},La=function(){p&&p(),Ma(!0),sn(0),en(0),rn(0),ae([]),de([]),G([z.firstSequence]),Zt(0),Ft([]),Pt([])},za=function(){Ma(!0),ka()},Da=function(){da.current&&da.current.togglePause(),Gt(!0)},Ma=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Gt(!1),da.current&&da.current.togglePause(e)},Fa=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];E?la(!e||"reset"):e?La():za()},Aa=z&&Cn&&Cn.length>0?Cn.filter((function(e){var t=e.gauge;return!t.condition||q(z,Se,_t,t.condition)})):null,Ba=F[e.lang||"fr"],Ua=z&&z.meta&&z.meta.options.displayTitleBar;return z?c.a.createElement(A.Provider,{value:Ba},c.a.createElement(o.Fragment,null,c.a.createElement("div",{className:"story-player-container",style:Vn},c.a.createElement(y.a,{className:st||Wt||hn||kn?"blurred":""},Ua&&c.a.createElement("div",{className:"topbar",style:{background:Bn.topbarBackground,color:Bn.topbarText,fontFamily:In.styles.fontFamily}},"MOIKI ",z.meta?"- "+z.meta.name:""),c.a.createElement("div",{style:{display:"flex",width:"100%",height:Ua?"calc(100% - 19px)":"100%",position:"relative"}},c.a.createElement(Ze,{theme:Dn,images:z.images,bgStylesFix:l}),c.a.createElement("div",{className:"main-content"},(Se.hero||Se.objects&&Se.objects.length>0||Aa&&Aa.length>0)&&c.a.createElement("div",{className:"game-bar",style:{background:Bn.assetsBackground}},c.a.createElement("div",{style:{display:"flex",alignItems:"center"}},Se.hero?c.a.createElement(Ee,{icon:(Ca=Se.hero,ya(Ca).icon),className:"hero",style:{fill:Bn.assetsFill,stroke:Bn.assetsFill}}):c.a.createElement("div",null),c.a.createElement("div",{className:"gauges-container"},c.a.createElement("div",{className:"gauges-container-wrapper",style:{color:Bn.assetsFill}},Aa&&Aa.sort((function(e,t){return e.gauge.order-t.gauge.order})).map((function(t,n){var a=e.story.counters[t.id]||{},r=a.gauge,o=Object(d.a)(a,["gauge"]),l=Se.counters.find((function(e){return e.id===t.id})).value;return c.a.createElement(We,{key:"gauge-"+n,value:isNaN(l)||null===l?o.defaultValue:l,gauge:r,counter:o,styles:Bn,computedStyles:Jn})}))))),c.a.createElement("div",{className:"game-objects"},Se.objects&&Se.objects.length>0&&c.a.createElement("button",{style:Jn.button,onClick:function(){da.current&&da.current.togglePause(),wn(!0)}},c.a.createElement(g.a,{name:"star",style:{margin:0}})," (",Se.objects.length,")"))),!qe&&!xe&&!Ge&&!ot&&c.a.createElement(le,{story:z,gameData:Se,path:_t,routineExit:Mt&&Mt.length>0?Mt[Mt.length-1]:[],styles:Jn,playClickSound:function(){Bn.sfx&&Bn.sfx.button&&Ta(Bn.sfx.button)},sequence:ga(ve),gotoSequence:ja,theme:{styles:Bn},showStats:Da,reducedViewport:a,canUndo:z.meta&&z.meta.options&&z.meta.options.allowBack&&_t.length>1&&(1===dn.length&&!wa(_t,dn[0].path)||dn.length>1),undo:xa,canAddReview:!1,canShowStats:N,onReplay:E?Fa:null,randomSeeds:dn.length>0?dn[dn.length-1].randomSeeds:[0,.3,.5,.6]}))),e.showMenu&&c.a.createElement(o.Fragment,null,c.a.createElement("div",{style:{position:"absolute",bottom:10,left:0,display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",zIndex:4},className:"player-menu"},z.meta&&z.meta.options.allowBack&&_t.length>1&&dn.length>0&&c.a.createElement("button",{disabled:1===dn.length&&wa(_t,dn[0].path),style:Jn.button,onClick:xa},c.a.createElement(g.a,{name:"undo",style:{margin:0}})),c.a.createElement("button",{style:Jn.button,onClick:Da},c.a.createElement(g.a,{name:"setting",style:{margin:0}})),c.a.createElement("button",{style:Jn.button,onClick:function(){da.current&&da.current.togglePause(),On(!0)}},c.a.createElement(g.a,{name:"info",style:{margin:0}})),w&&c.a.createElement("button",{style:Jn.button,onClick:function(){return x()}},c.a.createElement(g.a,{name:"power off",style:{margin:0}}))),z.meta&&z.meta.options.showStats&&c.a.createElement("div",{style:Object(m.a)({position:"absolute",bottom:10,right:10,padding:"0.2em 0.5em",borderRadius:"1em",opacity:.7},Jn.sequence)},W.length," / ",U)))),xe&&c.a.createElement(pe,{textStyle:$n,params:xe,theme:{styles:Bn},onClosed:Ra}),qe&&c.a.createElement(Xe,{textStyle:$n,params:qe,theme:{styles:Bn},onClosed:Ra}),z.sounds&&c.a.createElement(ge,{ref:da,sounds:z.sounds,onReady:function(){return Et(!0)},onProgress:function(e){return St(e)}}),na&&c.a.createElement(Fe,{alternate:!0,size:"mini",title:Ba.RESUME,content:c.a.createElement("div",{style:{padding:"1em"}},c.a.createElement("p",null,Ba.RESUME_MSG),c.a.createElement("p",null,c.a.createElement("b",null,(Ba.RESUME_DATE||"").split("%s").join(Ye()(na.delay,{language:e.lang||"fr",round:!0,largest:2})))),c.a.createElement("p",{style:{color:"#7a7a7a"}},c.a.createElement("em",null,Ba.RESUME_ALERT))),cancelLabel:Ba.DO_NOT_RESUME,cancelIcon:c.a.createElement(g.a,{name:"redo"}),confirmLabel:Ba.LOAD,open:!!na,onCancel:function(){aa(null),_a({sounds:!0})},onConfirm:function(){Qe=!0;var t=na.data,n=na.stats;if(aa(null),u&&u(Tt),ut(!1),bt({sounds:!0}),t&&t.length>0){var a=t.pop();fn(t);var r=a.id,o=a.path,c=a.gameData,l=a.currentLoop,i=a.currentTheme,s=a.routinesExit,m=a.eventsDone,d=e.story.themes.find((function(e){return e.identifier===(i||"default")}));Mn(d),je(c),Lt(o),ye(r),Ft(s),Pt(m),G(n.sequencesShown),ae(n.heroesShown),de(n.objectsShown),Zt(n.numReplays),en(n.numVictories),rn(n.numDefeats),sn(n.numUndo),l&&Ta(l,!0)}}}),ca&&c.a.createElement(Fe,{size:"mini",title:"reset"===ca?Ba.RESET:Ba.RESTART,content:c.a.createElement("div",{style:{padding:"1em"}},c.a.createElement("p",null,"reset"===ca?Ba.RESET_MSG:Ba.RESTART_MSG,c.a.createElement("br",null),c.a.createElement("br",null),c.a.createElement("b",null,Ba.WILL_LOSE_BACKUP))),cancelLabel:Ba.CANCEL,confirmLabel:"reset"===ca?Ba.RESET_GAME:Ba.RESTART,open:!!ca,onCancel:function(){la(!1)},onConfirm:function(){var e="reset"===ca;la(!1),e?La():za()}}),st&&!vn&&c.a.createElement("div",{className:"story-overlay"},c.a.createElement(Ne,{story:z,soundsLoaded:yt,soundsProgress:Ot,onStart:_a,onShowCredits:function(){return yn(!0)}})),Wt&&!vn&&c.a.createElement("div",{className:"story-overlay"},c.a.createElement(Ie,{story:z,onClose:function(){return Ma()},onShowCredits:function(){return yn(!0)},onReset:function(){Fa(!0)},onRestart:function(){Fa()},gameOptions:ft,stats:{numSequencesShown:W.length,numSequencesTotal:U,numHeroesShown:ne.length,numHeroesTotal:K,numObjectsShown:me.length,numObjectsTotal:ce,numUndo:ln,numReplays:Kt,numVictories:Qt,numDefeats:an}})),hn&&!vn&&c.a.createElement("div",{className:"story-overlay"},c.a.createElement(De,{story:z,onClose:function(){On(!1),da.current&&da.current.togglePause()},showPlatformInfo:C})),vn&&c.a.createElement("div",{className:"story-overlay"},c.a.createElement(_e,{story:z,onClose:function(){return yn(!1)}})),kn&&c.a.createElement("div",{className:"story-overlay"},c.a.createElement(Ae,{getAssetById:ya,objects:Se.objects,onClose:function(){wn(!1),da.current&&da.current.togglePause()},styles:Bn})))):null})),tt=n(245),nt=n.n(tt),at=n(347),rt=n.n(at),ot=n(348),ct=n.n(ot),lt=(n(653),["fr","en"]),it=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"id",n={};return e.reduce((function(e,n){return Object(m.a)({},e,Object(u.a)({},n[t],n))}),n)};var st=function(){var e=Object(o.useRef)(null),t=Object(o.useState)(null),n=Object(s.a)(t,2),a=n[0],r=n[1],l=function(e,t){var n=function(){try{var n=window.localStorage.getItem(e);return n?JSON.parse(n):t}catch(a){return t}},a=Object(o.useState)(n()),r=Object(s.a)(a,2),c=r[0],l=r[1];return Object(o.useEffect)((function(){var e=function(){return l(n())};return window.addEventListener("storage",e),function(){window.removeEventListener("storage",e)}}),[]),[c,function(t){try{var n=t instanceof Function?t(c):t;return l(n),window.localStorage.setItem(e,JSON.stringify(n)),!0}catch(a){return!1}}]}("moiki-player",{}),i=Object(s.a)(l,2),d=i[0],g=i[1],v=window.moiki_story,y=document.querySelector('meta[property="og:title"]').content,E=ct.a.decode(rt.a.decode(v)),p=JSON.parse(nt.a.AES.decrypt(E,y).toString(nt.a.enc.Utf8)),h=window.language;return Object(o.useEffect)((function(){p.routines&&p.routines.length>0&&function(e){var t,n=function(e,t){if(e.next&&(e.next=t+":"+e.next),"passage"===e.kind&&e.query.params&&e.query.params.length>0)e.query.params[0].target&&(e.query.params[0].target=t+":"+e.query.params[0].target);else if("multiple"===e.kind&&e.query.params&&e.query.params.length>0){var n,a=Object(b.a)(e.query.params||[]);try{for(a.s();!(n=a.n()).done;){var r=n.value;"passage"===r.kind&&r.target&&(r.target=t+":"+r.target)}}catch(o){a.e(o)}finally{a.f()}}},a=function(e,t){var a,r=Object(b.a)(e.conditions||[]);try{for(r.s();!(a=r.n()).done;){var o=a.value;n(o,t)}}catch(c){r.e(c)}finally{r.f()}},r=[{id:Object(_.a)(),sequences:e.sequences}].concat(Object(f.a)(e.routines)),o=0,c=Object(b.a)(r);try{for(c.s();!(t=c.n()).done;){var l,i=t.value,s=Object(b.a)(i.sequences);try{var u=function(){var e=l.value;e.id=o+":"+e.id,a(e,o);var t,c=Object(b.a)(e.choices||[]);try{for(c.s();!(t=c.n()).done;){var i=t.value;a(i,o),i.next&&(i.next=o+":"+i.next),i.showCondition&&n(i.showCondition,o)}}catch(y){c.e(y)}finally{c.f()}if(e.puzzle){e.puzzle.defaultNext&&(e.puzzle.defaultNext=o+":"+e.puzzle.defaultNext);var s,u=Object(b.a)(e.puzzle.codes||[]);try{for(u.s();!(s=u.n()).done;){var m=s.value;m.next&&(m.next=o+":"+m.next)}}catch(y){u.e(y)}finally{u.f()}}if(e.routineId){var d=r.findIndex((function(t){return t.id===e.routineId}));e.redirectTo=d+":"+r[d].firstSequence;var f,g=Object(b.a)(e.routineExit||[]);try{for(g.s();!(f=g.n()).done;){var v=f.value;v.from=v.from?d+":"+v.from:v.from,v.next=v.next?o+":"+v.next:v.next,a(v,o)}}catch(y){g.e(y)}finally{g.f()}}e.next&&(e.next=o+":"+e.next)};for(s.s();!(l=s.n()).done;)u()}catch(S){s.e(S)}finally{s.f()}++o}}catch(S){c.e(S)}finally{c.f()}e.sequences=r.reduce((function(e,t){return[].concat(Object(f.a)(e),Object(f.a)(t.sequences))}),[]),e.firstSequence="0:"+e.firstSequence;var m,d=Object(b.a)(e.events);try{for(d.s();!(m=d.n()).done;){var g=m.value;g.condition&&n(g.condition,"0");var v,y=Object(b.a)(g.actions||[]);try{for(y.s();!(v=y.n()).done;){var E=v.value;"redirect"===E.kind&&E.params.target&&(E.params.target="0:"+E.params.target)}}catch(S){y.e(S)}finally{y.f()}}}catch(S){d.e(S)}finally{d.f()}var p,h=Object(b.a)(e.counters);try{for(h.s();!(p=h.n()).done;){var O=p.value;O.gauge&&O.gauge.condition&&n(O.gauge.condition,"0")}}catch(S){h.e(S)}finally{h.f()}}(p),r(Object(m.a)({},p,{sequences:it(p.sequences),images:it(p.images||[]),assets:it(p.assets||[]),sounds:it(p.sounds||[]),counters:it(p.counters||[]),textvars:it(p.textvars||[]),themes:p.themes||[Object(m.a)({},p.theme,{identifier:"default",idName:"default"})]}))}),[]),p&&h?(lt.includes(h)||(h="fr"),a?c.a.createElement(et,{ref:e,lang:h,story:a,showMenu:!0,onReady:function(){if(d&&e.current){var t=d[a._id];if(t){var n=a.meta.modificationDate;t.version===n?e.current.loadGame(Object(m.a)({},t,{delay:t.date?(new Date).getTime()-t.date:0})):console.log("oh oh ! there is a backup for this game, but the version has changed since then! will skip it :(")}}},onSavePoint:function(e){var t=e.data,n=e.stats;d&&a&&t.length>0&&t[t.length-1].path&&t[t.length-1].path.length>3&&g(Object(m.a)({},d,Object(u.a)({},a._id,{version:a.meta.modificationDate,date:(new Date).getTime(),data:t,stats:n})))}}):null):null};n(654),n(655);i.a.createRoot(document.getElementById("root")).render(c.a.createElement(st,null))}},[[359,1,2]]]);
//# sourceMappingURL=main.8a4bd063.chunk.js.map